import{d as _}from"./chunk-LWWUIYI5.js";import{c as H,d as x,h as k,k as Q,l as B,m as Z}from"./chunk-JDD6CJWT.js";import"./chunk-Z3XA4MJF.js";import{T as m,U as N,V as P,W as F}from"./chunk-6CHLEOQA.js";import"./chunk-LRH6MGM6.js";import{Bc as w,Bd as A,Fc as d,Ge as p,Hc as O,He as V,Lc as h,M as I,Md as T,Od as R,Zd as M,a as f,b as U,of as j,pa as u,pe as D,qa as g,qf as $,sa as s,se as S,ta as v,ue as C,v as y,wf as L,ya as b}from"./chunk-VZM7NBJ6.js";var W=(()=>{class r{constructor(t){this.converter=t}convert(t,e){return e===void 0&&(e=f({},t)),this.removeDuplicatePromotions(t,e),this.handleQuoteCode(t,e),t.entries&&(e.entries=t.entries.map(i=>U(f({},i),{product:this.converter.convert(i.product,L),promotions:this.converter.convert({item:i,promotions:e?.appliedProductPromotions},N)}))),e}handleQuoteCode(t,e){t.sapQuote&&(e.quoteCode=t.sapQuote.code)}removeDuplicatePromotions(t,e){t&&t.potentialOrderPromotions&&(e.potentialOrderPromotions=this.removeDuplicateItems(t.potentialOrderPromotions)),t&&t.potentialProductPromotions&&(e.potentialProductPromotions=this.removeDuplicateItems(t.potentialProductPromotions)),t&&t.appliedOrderPromotions&&(e.appliedOrderPromotions=this.removeDuplicateItems(t.appliedOrderPromotions)),t&&t.appliedProductPromotions&&(e.appliedProductPromotions=this.removeDuplicateItems(t.appliedProductPromotions))}removeDuplicateItems(t){return t.filter((e,i,o)=>{let n=o.map(a=>JSON.stringify(a));return i===n.indexOf(JSON.stringify(e))})}static{this.\u0275fac=function(e){return new(e||r)(s(p))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),Y=(()=>{class r{convert(t,e){return e=this.getProductPromotion(t.item,t.promotions),e}getProductPromotion(t,e){let i=[];return e?.forEach(o=>{if(o.description&&o.consumedEntries)for(let n of o.consumedEntries)this.isConsumedByEntry(n,t)&&i.push(o)}),i}isConsumedByEntry(t,e){let i=t.orderEntryNumber;if(e&&e.entries&&e.entries.length>0){for(let o of e.entries)if(o.entryNumber===i)return!0;return!1}else return i===e?.entryNumber}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),z=(()=>{class r{constructor(t,e,i){this.http=t,this.occEndpointsService=e,this.converterService=i}add(t,e,i,o=1,n){let a=this.occEndpointsService.buildUrl("addEntries",{urlParams:{userId:t,cartId:e,quantity:o}});if(a.includes(`quantity=${o}`)){let E=new d({"Content-Type":"application/x-www-form-urlencoded"});return this.http.post(a,{},{headers:E,params:{code:i}}).pipe(this.converterService.pipeable(P))}let c=f({quantity:o,product:{code:i}},n&&{deliveryPointOfService:{name:n}}),l=new d({"Content-Type":"application/json"});return this.http.post(a,c,{headers:l}).pipe(this.converterService.pipeable(P))}update(t,e,i,o,n,a=!1){let c=new d({"Content-Type":"application/json"}),l=this.occEndpointsService.buildUrl("updateEntries",{urlParams:{userId:t,cartId:e,entryNumber:i}});if(n===void 0&&a)return this.http.put(l,{quantity:o},{headers:c}).pipe(this.converterService.pipeable(P));let E={};return n&&(E={deliveryPointOfService:{name:n}}),this.http.patch(l,f({quantity:o},E),{headers:c}).pipe(this.converterService.pipeable(P))}remove(t,e,i){let o=new d({"Content-Type":"application/x-www-form-urlencoded"}),n=this.occEndpointsService.buildUrl("removeEntries",{urlParams:{userId:t,cartId:e,entryNumber:i}});return this.http.delete(n,{headers:o})}static{this.\u0275fac=function(e){return new(e||r)(s(h),s(C),s(p))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})(),K=(()=>{class r{constructor(t,e,i){this.http=t,this.occEndpoints=e,this.converter=i,this.logger=v(M)}getCartVoucherEndpoint(t,e){return this.occEndpoints.buildUrl("cartVoucher",{urlParams:{userId:t,cartId:e}})}getHeaders(t){let e=new d({"Content-Type":"application/json"});return t===T&&(e=S.createHeader(D,!0,e)),e}add(t,e,i){let o=this.getCartVoucherEndpoint(t,e),n=JSON.stringify({}),a=new O().set("voucherId",i),c=this.getHeaders(t);return this.http.post(o,n,{headers:c,params:a}).pipe(I(l=>{throw V(l,this.logger)}),this.converter.pipeable(F))}remove(t,e,i){let o=this.getCartVoucherEndpoint(t,e)+"/"+encodeURIComponent(i),n=this.getHeaders(t);return this.http.delete(o,{headers:n}).pipe(I(a=>{throw V(a,this.logger)}))}static{this.\u0275fac=function(e){return new(e||r)(s(h),s(C),s(p))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})(),G=(()=>{class r{constructor(t,e,i){this.http=t,this.occEndpointsService=e,this.converterService=i,this.featureConfigService=v(j)}loadAll(t){return this.http.get(this.occEndpointsService.buildUrl("carts",{urlParams:{userId:t}})).pipe(y(e=>e.carts??[]),this.converterService.pipeableMany(m))}load(t,e){return e===R?this.loadAll(t).pipe(y(i=>i.find(o=>o.saveTime===void 0))):this.http.get(this.occEndpointsService.buildUrl("cart",{urlParams:{userId:t,cartId:e}})).pipe(this.converterService.pipeable(m))}create(t,e,i){let o=JSON.stringify({}),n={};return e&&(n.oldCartId=e),i&&(n.toMergeCartGuid=i),this.http.post(this.occEndpointsService.buildUrl("createCart",{urlParams:{userId:t},queryParams:n}),o).pipe(this.converterService.pipeable(m))}delete(t,e){let i=new d;return t===T&&(i=S.createHeader(D,!0,i)),this.http.delete(this.occEndpointsService.buildUrl("deleteCart",{urlParams:{userId:t,cartId:e}}),{headers:i})}save(t,e,i,o){let n=this.occEndpointsService.buildUrl("saveCart",{urlParams:{userId:t,cartId:e,saveCartName:i,saveCartDescription:o}}),a=new O;return this.featureConfigService?.isEnabled("occCartNameAndDescriptionInHttpRequestBody")&&(a=a.set("saveCartName",i).set("saveCartDescription",o)),this.http.patch(n,a).pipe(y(c=>c.savedCartData),this.converterService.pipeable(m))}addEmail(t,e,i){let o=new d({"Content-Type":"application/x-www-form-urlencoded"});o=S.createHeader(D,!0,o);let n=new O().set("email",i),a=this.occEndpointsService.buildUrl("addEmail",{urlParams:{userId:t,cartId:e}});return this.http.put(a,n,{headers:o})}static{this.\u0275fac=function(e){return new(e||r)(s(h),s(C),s(p))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})(),X=(()=>{class r{constructor(t,e,i){this.http=t,this.occEndpoints=e,this.converter=i,this.logger=v(M)}validate(t,e){let i=this.occEndpoints.buildUrl("validate",{urlParams:{cartId:t,userId:e}});return this.http.post(i,null).pipe(I(o=>{throw V(o,this.logger)}),this.converter.pipeable(Z))}static{this.\u0275fac=function(e){return new(e||r)(s(h),s(C),s(p))}}static{this.\u0275prov=u({token:r,factory:r.\u0275fac})}}return r})();function ee(){return{backend:{occ:{endpoints:{carts:"users/${userId}/carts?fields=carts(DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),totalUnitCount,deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),user,saveTime,name,description)",cart:"users/${userId}/carts/${cartId}?fields=DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),totalUnitCount,deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),user,saveTime,name,description",createCart:"users/${userId}/carts?fields=DEFAULT,potentialProductPromotions,appliedProductPromotions,potentialOrderPromotions,appliedOrderPromotions,entries(totalPrice(formattedValue),product(images(FULL),stock(FULL)),basePrice(formattedValue,value),updateable),totalPrice(formattedValue),totalItems,totalPriceWithTax(formattedValue),totalDiscounts(value,formattedValue),subTotal(formattedValue),totalUnitCount,deliveryItemsQuantity,deliveryCost(formattedValue),totalTax(formattedValue, value),pickupItemsQuantity,net,appliedVouchers,productDiscounts(formattedValue),user",addEntries:"users/${userId}/carts/${cartId}/entries",updateEntries:"users/${userId}/carts/${cartId}/entries/${entryNumber}",removeEntries:"users/${userId}/carts/${cartId}/entries/${entryNumber}",addEmail:"users/${userId}/carts/${cartId}/email",deleteCart:"users/${userId}/carts/${cartId}",cartVoucher:"users/${userId}/carts/${cartId}/vouchers",saveCart:v($).occCartNameAndDescriptionInHttpRequestBody?"/users/${userId}/carts/${cartId}/save":"/users/${userId}/carts/${cartId}/save?saveCartName=${saveCartName}&saveCartDescription=${saveCartDescription}",validate:"users/${userId}/carts/${cartId}/validate?fields=DEFAULT"}}}}}var q=(()=>{class r{static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275mod=b({type:r})}static{this.\u0275inj=g({providers:[A(ee),{provide:k,useClass:G},{provide:m,useExisting:W,multi:!0},{provide:N,useExisting:Y,multi:!0},{provide:H,useClass:z},{provide:x,useClass:K},{provide:Q,useClass:X}],imports:[w]})}}return r})();var Ce=(()=>{class r{static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275mod=b({type:r})}static{this.\u0275inj=g({imports:[B,q,_]})}}return r})();export{Ce as CartBaseModule};

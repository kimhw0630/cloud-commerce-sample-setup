import{a as U}from"./chunk-NPMS5DET.js";import{b as se,e as ie}from"./chunk-X5TAUIJY.js";import{C as ee,H as te,n as z,o as p,p as J,q as Z,z as $}from"./chunk-6CHLEOQA.js";import{$e as F,Ad as A,Ae as E,Ag as _,Bd as K,Be as a,Bg as q,Cg as T,Dg as Q,G as h,I as N,If as k,Jf as D,Kc as H,Mc as V,Md as P,Q as L,Zc as X,af as j,be as Y,cf as I,df as w,f as d,ha as M,ka as G,lf as O,pa as o,pg as y,qa as m,sa as i,v as x,wd as B,ya as R,zg as W}from"./chunk-VZM7NBJ6.js";var ne=function(e){return e.FREE="FREE",e.LEAST_EXPENSIVE="LEAST_EXPENSIVE",e.MOST_EXPENSIVE="MOST_EXPENSIVE",e}(ne||{}),Xe=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=o({token:e,factory:function(s){let r=null;return s?r=new(s||e):r=i(B),r},providedIn:"root"})}}return e})(),oe={checkout:{steps:[{id:"deliveryAddress",name:"checkoutProgress.deliveryAddress",routeName:"checkoutDeliveryAddress",type:["deliveryAddress"]},{id:"deliveryMode",name:"checkoutProgress.deliveryMode",routeName:"checkoutDeliveryMode",type:["deliveryMode"]},{id:"paymentDetails",name:"checkoutProgress.paymentDetails",routeName:"checkoutPaymentDetails",type:["paymentDetails"]},{id:"reviewOrder",name:"checkoutProgress.reviewOrder",routeName:"checkoutReviewOrder",type:["reviewOrder"]}],express:!1,defaultDeliveryMode:[ne.FREE],guest:!1}},ce={routing:{routes:{checkoutLogin:{paths:["checkout-login"],authFlow:!0},checkout:{paths:["checkout"]},checkoutDeliveryAddress:{paths:["checkout/delivery-address"]},checkoutDeliveryMode:{paths:["checkout/delivery-mode"]},checkoutPaymentDetails:{paths:["checkout/payment-details"]},checkoutReviewOrder:{paths:["checkout/review-order"]}}}},de=(()=>{class e extends E{static{this.type="CheckoutQueryReloadEvent"}}return e})(),c=(()=>{class e extends E{static{this.type="CheckoutQueryResetEvent"}}return e})(),f=class extends E{},S=class extends f{},ae=(()=>{class e extends S{static{this.type="CheckoutDeliveryAddressCreatedEvent"}}return e})(),ve=(()=>{class e extends S{static{this.type="CheckoutDeliveryAddressSetEvent"}}return e})(),ue=(()=>{class e extends S{static{this.type="CheckoutDeliveryAddressClearedEvent"}}return e})(),v=class extends f{},he=(()=>{class e extends v{static{this.type="CheckoutDeliveryModeSetEvent"}}return e})(),le=(()=>{class e extends v{static{this.type="CheckoutDeliveryModeClearedEvent"}}return e})(),ye=(()=>{class e extends v{static{this.type="CheckoutDeliveryModeClearedErrorEvent"}}return e})(),pe=(()=>{class e extends v{static{this.type="CheckoutSupportedDeliveryModesQueryReloadEvent"}}return e})(),C=(()=>{class e extends v{static{this.type="CheckoutSupportedDeliveryModesQueryResetEvent"}}return e})(),l=class extends f{},Ce=(()=>{class e extends l{static{this.type="CheckoutPaymentDetailsCreatedEvent"}}return e})(),fe=(()=>{class e extends l{static{this.type="CheckoutPaymentDetailsSetEvent"}}return e})(),Se=(()=>{class e extends l{static{this.type="CheckoutPaymentCardTypesQueryReloadEvent"}}return e})(),Be=(()=>{class e extends l{static{this.type="CheckoutPaymentCardTypesQueryResetEvent"}}return e})(),ge=(()=>{class e{constructor(t){this.eventService=t,this.subscriptions=new d,this.onCheckoutQueryReload(),this.onCheckoutQueryReset()}onCheckoutQueryReload(){this.subscriptions.add(h(this.eventService.get(k),this.eventService.get(D)).subscribe(()=>{this.eventService.dispatch({},de)}))}onCheckoutQueryReset(){this.subscriptions.add(h(this.eventService.get(F),this.eventService.get(j),this.eventService.get(se),this.eventService.get(ie),this.eventService.get(z),this.eventService.get(U)).subscribe(()=>{this.eventService.dispatch({},c)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a))}}static{this.\u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),re="checkout",g="checkoutCore",Ee=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=o({token:e,factory:()=>y({facade:e,feature:g,methods:["getDeliveryAddressState","createAndSetAddress","setDeliveryAddress","clearCheckoutDeliveryAddress"],async:!0}),providedIn:"root"})}}return e})(),ke=(()=>{class e{constructor(t,s,r,u){this.checkoutDeliveryAddressFacade=t,this.eventService=s,this.globalMessageService=r,this.activeCartFacade=u,this.subscriptions=new d,this.onDeliveryAddressCreated(),this.onDeliveryAddressSet(),this.onDeliveryAddressCleared(),this.onUserAddressChange(),this.onCartDeleted()}onUserAddressChange(){this.subscriptions.add(this.eventService.get(W).pipe(N(t=>t instanceof _||t instanceof q),M(({userId:t})=>this.activeCartFacade.takeActiveCartId().pipe(x(s=>({cartId:s,userId:t}))))).subscribe(({cartId:t,userId:s})=>{this.checkoutDeliveryAddressFacade.clearCheckoutDeliveryAddress(),this.eventService.dispatch({cartId:t,userId:s},C)}))}onDeliveryAddressCreated(){this.subscriptions.add(this.eventService.get(ae).subscribe(({cartId:t,userId:s})=>{s!==P&&this.eventService.dispatch({userId:s},T),this.globalMessageService.add({key:"addressForm.userAddressAddSuccess"},I.MSG_TYPE_CONFIRMATION),this.eventService.dispatch({userId:s,cartId:t},C),this.eventService.dispatch({},c)}))}onDeliveryAddressSet(){this.subscriptions.add(this.eventService.get(ve).subscribe(({userId:t,cartId:s})=>{this.eventService.dispatch({userId:t,cartId:s},C),this.eventService.dispatch({},c)}))}onDeliveryAddressCleared(){this.subscriptions.add(this.eventService.get(ue).subscribe(()=>this.eventService.dispatch({},c)))}onCartDeleted(){this.subscriptions.add(this.eventService.get(Z).subscribe(()=>this.eventService.dispatch({},c)))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(Ee),i(a),i(w),i(te))}}static{this.\u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),De=(()=>{class e{constructor(t){this.eventService=t,this.subscriptions=new d,this.onDeliveryModeSet(),this.onDeliveryModeCleared(),this.onDeliveryModeClearedError(),this.onDeliveryModeReset(),this.onGetSupportedDeliveryModesQueryReload(),this.onGetSupportedDeliveryModesQueryReset()}onDeliveryModeSet(){this.subscriptions.add(this.eventService.get(he).subscribe(({userId:t,cartId:s,cartCode:r})=>{this.eventService.dispatch({},c),this.eventService.dispatch({userId:t,cartId:s,cartCode:r},p)}))}onDeliveryModeCleared(){this.subscriptions.add(this.eventService.get(le).subscribe(({userId:t,cartId:s,cartCode:r})=>{this.eventService.dispatch({},c),this.eventService.dispatch({userId:t,cartId:s,cartCode:r},p)}))}onDeliveryModeClearedError(){this.subscriptions.add(this.eventService.get(ye).subscribe(({userId:t,cartId:s,cartCode:r})=>{this.eventService.dispatch({},c),this.eventService.dispatch({userId:t,cartId:s,cartCode:r},p)}))}onDeliveryModeReset(){this.subscriptions.add(this.eventService.get(C).subscribe(({userId:t,cartId:s})=>this.eventService.dispatch({userId:t,cartId:s,cartCode:s},p)))}onGetSupportedDeliveryModesQueryReload(){this.subscriptions.add(h(this.eventService.get(k),this.eventService.get(D)).subscribe(()=>{this.eventService.dispatch({},pe)}))}onGetSupportedDeliveryModesQueryReset(){this.subscriptions.add(h(this.eventService.get(F),this.eventService.get(j)).subscribe(()=>{this.eventService.dispatch({},C)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a))}}static{this.\u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),be=(()=>{class e{constructor(t,s){this.eventService=t,this.globalMessageService=s,this.subscriptions=new d,this.onPaymentCreated(),this.onPaymentSet(),this.onGetCardTypesQueryReload()}onPaymentCreated(){this.subscriptions.add(this.eventService.get(Ce).subscribe(({userId:t})=>{t!==P&&this.eventService.dispatch({userId:t},Q),this.globalMessageService.add({key:"paymentForm.paymentAddedSuccessfully"},I.MSG_TYPE_CONFIRMATION),this.eventService.dispatch({},c)}))}onPaymentSet(){this.subscriptions.add(this.eventService.get(fe).subscribe(()=>{this.eventService.dispatch({},c)}))}onGetCardTypesQueryReload(){this.subscriptions.add(h(this.eventService.get(k),this.eventService.get(D)).subscribe(()=>{this.eventService.dispatch({},Se)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a),i(w))}}static{this.\u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Me=(()=>{class e{constructor(t){this.eventService=t,this.subscriptions=new d,this.onOrderPlaced()}onOrderPlaced(){this.subscriptions.add(this.eventService.get(U).subscribe(({userId:t,cartId:s,cartCode:r})=>{this.eventService.dispatch({userId:t,cartId:s,cartCode:r},J),this.eventService.dispatch({},c)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a))}}static{this.\u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),me=(()=>{class e{constructor(t,s){this.eventService=t,this.store=s,this.subscriptions=new d,this.onUserAddressAction(),this.onUserPaymentAction()}onUserAddressAction(){this.subscriptions.add(this.eventService.get(T).subscribe(({userId:t})=>{this.store.dispatch(new O.LoadUserAddresses(t))}))}onUserPaymentAction(){this.subscriptions.add(this.eventService.get(Q).subscribe(({userId:t})=>{this.store.dispatch(new O.LoadUserPaymentMethods(t))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)(i(a),i(X))}}static{this.\u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Re=(()=>{class e{constructor(t,s,r,u,b,Ie){}static{this.\u0275fac=function(s){return new(s||e)(i(ge),i(ke),i(De),i(be),i(Me),i(me))}}static{this.\u0275mod=R({type:e})}static{this.\u0275inj=m({})}}return e})(),Ae=(()=>{class e{constructor(t,s){this.routingService=t,this.multiCartFacade=s}intercept(t,s){return this.routingService.getRouterState().pipe(L(1),M(r=>s.handle(t).pipe(G({error:u=>{if(u instanceof H&&this.isUserInCheckoutRoute(r.state?.semanticRoute)&&this.isCartNotFoundError(u)){this.routingService.go({cxRoute:"cart"});let b=this.getCartIdFromError(u);b&&this.multiCartFacade.reloadCart(b)}}}))))}isUserInCheckoutRoute(t){return t?.toLowerCase().startsWith("checkout")??!1}isCartNotFoundError(t){return t.status===400&&t.error?.errors?.[0]?.type==="CartError"&&t.error?.errors?.[0]?.reason==="notFound"}getCartIdFromError(t){return t.error?.errors?.[0]?.subject}static{this.\u0275fac=function(s){return new(s||e)(i(Y),i(ee))}}static{this.\u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Pe=[{provide:V,useExisting:Ae,multi:!0}],Fe=["CheckoutOrchestrator","CheckoutOrderSummary","CheckoutProgress","CheckoutProgressMobileBottom","CheckoutProgressMobileTop","CheckoutDeliveryMode","CheckoutPaymentDetails","CheckoutPlaceOrder","CheckoutReviewOrder","CheckoutReviewPayment","CheckoutReviewShipping","CheckoutReviewOverview","CheckoutDeliveryAddress","GuestCheckoutLoginComponent"];function je(){return{featureModules:{[re]:{cmsComponents:Fe,dependencies:[$]},[g]:re}}}var Ke=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=R({type:e})}static{this.\u0275inj=m({providers:[...Pe,A(ce),A(oe),K(je)],imports:[Re]})}}return e})(),Ye=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=o({token:e,factory:()=>y({facade:e,feature:g,methods:["getSupportedDeliveryModesState","getSupportedDeliveryModes","setDeliveryMode","getSelectedDeliveryModeState","clearCheckoutDeliveryMode"],async:!0}),providedIn:"root"})}}return e})(),We=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=o({token:e,factory:()=>y({facade:e,feature:g,methods:["getPaymentCardTypesState","getPaymentCardTypes","getPaymentDetailsState","createPaymentDetails","setPaymentDetails"],async:!0}),providedIn:"root"})}}return e})(),_e=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=o({token:e,factory:()=>y({facade:e,feature:g,methods:["getCheckoutDetailsState"]}),providedIn:"root"})}}return e})();export{ne as a,Xe as b,de as c,c as d,ae as e,ve as f,ue as g,he as h,le as i,ye as j,pe as k,C as l,Ce as m,fe as n,Se as o,Be as p,re as q,Ee as r,Ke as s,Ye as t,We as u,_e as v};

import './polyfills.server.mjs';
import{a as Ze,b as Ht,c as Yt,d as Xt,e as st,f as Jt,h as Wt,i as ze,j as ei,k as ti,l as ii,m as ni,n as oi,o as ri,p as ci,q as si,r as ai,s as li,t as pi,v as b}from"./chunk-EXTB3HEV.mjs";import{H as zt}from"./chunk-TVE2QVOO.mjs";import{Aa as _e,B as Vt,C as se,Ca as ct,Da as Qe,I as $e,J as Pe,K as Ve,N as Ee,Oa as Gt,Ra as Qt,Ta as qt,V as ot,X as Ue,Y as ye,Z as ae,b as Oe,c as Q,d as Le,e as we,f as it,hb as Kt,i as X,ib as qe,ic as Ke,jb as Zt,l as je,ma as le,o as nt,p as Ne,ra as Ut,s as Be,t as Bt,u as $t,ua as rt,v as Pt,za as Ge}from"./chunk-6XFVW6FJ.mjs";import{$b as jt,Ea as Ft,Ha as fe,I as j,Ia as At,K as bt,La as ke,Ma as Ot,Na as Lt,O as It,Qa as wt,Ra as U,Y as Dt,Zb as We,_b as H,cc as et,dc as xe,ha as Mt,ja as Rt,kc as Nt,la as te,lc as tt,mb as ve,nb as Fe,nc as Ae,qb as ie,qc as G,rc as Y,x as Xe,z as Je}from"./chunk-JYBAAKHA.mjs";import{$a as W,$b as L,Aa as A,Bd as V,Fa as M,Ga as _,Gc as r,Hc as l,Ia as Z,Ib as De,Ic as I,Id as w,Ka as k,Kb as Me,L as ht,La as R,Lc as ce,Pb as f,Pd as Ye,Qb as $,Ra as F,Rb as m,S as D,Sa as S,T as Ct,Ta as vt,X as q,Xb as a,Xd as St,Yb as s,Zb as T,_a as J,_b as O,a as ne,ab as Ie,bc as ee,ca as ft,dc as v,ec as y,fb as xt,g as gt,hc as ge,ia as kt,kb as Et,kc as Te,lc as he,mc as Ce,nc as re,oc as p,pc as z,q as be,qc as u,r as Tt,rc as He,td as _t,vd as Re,wb as o,wd as P,x as C,xa as K,xb as g,y as oe,yc as yt,zc as x}from"./chunk-4X4JD2BX.mjs";import{a as ut,b as dt}from"./chunk-GHFNAT2I.mjs";var lt=["element"];function Fi(i,d){if(i&1){let e=ee();a(0,"div",2)(1,"button",3,0),v("click",function(){J(e);let n=y();return W(n.openDialog())}),p(3),r(4,"cxTranslate"),s()()}i&2&&(o(3),u(" ",l(4,1,"customerTicketingDetails.closeRequest")," "))}var ue=i=>({count:i});function Ai(i,d){i&1&&T(0,"cx-spinner",17)}function Oi(i,d){if(i&1&&(a(0,"option",24),p(1),s()),i&2){let e=d.$implicit,t=y(2);m("ngValue",e)("selected",e.id===(t.selectedCategory==null?null:t.selectedCategory.id)),o(),u(" ",e.name," ")}}function Li(i,d){if(i&1&&(a(0,"label")(1,"span",9),p(2),r(3,"cxTranslate"),s(),a(4,"select",21)(5,"option",22),p(6),r(7,"cxTranslate"),s(),f(8,Oi,2,3,"option",23),s(),T(9,"cx-form-errors",11),s()),i&2){let e=d.ngIf,t=y();o(2),u(" ",l(3,4,"createCustomerTicket.category")," "),o(4),u(" ",l(7,6,"createCustomerTicket.selectCategory")," "),o(2),m("ngForOf",e),o(),m("control",t.form.get("ticketCategory"))}}function wi(i,d){if(i&1&&(a(0,"option",24),p(1),s()),i&2){let e=d.$implicit,t=y(3);m("ngValue",e)("selected",e.code===(t.selectedAssociatedObject==null?null:t.selectedAssociatedObject.code)),o(),He(" ",e.type," ",e.code," ")}}function ji(i,d){if(i&1&&(a(0,"label")(1,"span",9),p(2),r(3,"cxTranslate"),s(),a(4,"select",25)(5,"option",22),p(6),r(7,"cxTranslate"),s(),f(8,wi,2,4,"option",23),s()()),i&2){let e=y().ngIf;o(2),u(" ",l(3,3,"createCustomerTicket.associateTo")," "),o(4),u(" ",l(7,5,"createCustomerTicket.optionallySelectAssociatedObject")," "),o(2),m("ngForOf",e)}}function Ni(i,d){if(i&1&&(O(0),f(1,ji,9,7,"label",13),L()),i&2){let e=d.ngIf;o(),m("ngIf",e.length>0)}}function Bi(i,d){if(i&1&&(T(0,"cx-icon",6),a(1,"span",26),p(2),r(3,"cxTranslate"),s()),i&2){let e=y();m("type",e.iconTypes.UPLOAD),o(2),z(l(3,2,"customerTicketing.uploadFile"))}}function $i(i,d){if(i&1&&(T(0,"cx-icon",6),a(1,"span",20),p(2),r(3,"cxTranslate"),s()),i&2){let e=y();m("type",e.iconTypes.UPLOAD),o(2),z(l(3,2,"customerTicketing.uploadFile"))}}function Pi(i,d){i&1&&T(0,"cx-spinner",21)}var pe=i=>({ticketCode:i}),me=i=>({cxRoute:"supportTicketDetails",params:i});function Vi(i,d){if(i&1){let e=ee();a(0,"tr",14),v("click",function(){let n=J(e).$implicit,c=y(3);return W(c.goToTicketDetail(n.id))}),a(1,"td",15)(2,"div",16),p(3),r(4,"cxTranslate"),s(),a(5,"a",17),r(6,"cxUrl"),p(7),s()(),a(8,"td",18)(9,"div",16),p(10),r(11,"cxTranslate"),s(),a(12,"a",17),r(13,"cxUrl"),p(14),s()(),a(15,"td",18)(16,"div",16),p(17),r(18,"cxTranslate"),s(),a(19,"a",17),r(20,"cxUrl"),p(21),s()(),a(22,"td",18)(23,"div",16),p(24),r(25,"cxTranslate"),s(),a(26,"a",17),r(27,"cxUrl"),p(28),r(29,"cxDate"),s()(),a(30,"td",18)(31,"div",16),p(32),r(33,"cxTranslate"),s(),a(34,"a",17),r(35,"cxUrl"),p(36),r(37,"cxDate"),s()(),a(38,"td",18)(39,"div",16),p(40),r(41,"cxTranslate"),s(),a(42,"a",19),r(43,"cxUrl"),p(44),s()()()}if(i&2){let e=d.$implicit,t=y(3);o(3),u(" ",l(4,19,"customerTicketingList.mobile.ticketIdFull")," "),o(2),m("routerLink",l(6,21,x(49,me,x(47,pe,e.id)))),o(2),u(" ",e.id," "),o(3),u(" ",l(11,23,"customerTicketingList.subject")," "),o(2),m("routerLink",l(13,25,x(53,me,x(51,pe,e.id)))),o(2),u(" ",e.subject," "),o(3),u(" ",l(18,27,"customerTicketingList.ticketCategory")," "),o(2),m("routerLink",l(20,29,x(57,me,x(55,pe,e.id)))),o(2),u(" ",e.ticketCategory==null?null:e.ticketCategory.name," "),o(3),u(" ",l(25,31,"customerTicketing.createdOn")," "),o(2),m("routerLink",l(27,33,x(61,me,x(59,pe,e.id)))),o(2),u(" ",l(29,35,e.createdAt)," "),o(4),u(" ",l(33,37,"customerTicketing.changedOn")," "),o(2),m("routerLink",l(35,39,x(65,me,x(63,pe,e.id)))),o(2),u(" ",l(37,41,e.modifiedAt)," "),o(4),u(" ",l(41,43,"customerTicketing.status")," "),o(2),m("routerLink",l(43,45,x(69,me,x(67,pe,e.id))))("ngClass",t.getStatusClass(e.status.id)),o(2),u(" ",e.status==null?null:e.status.name," ")}}function Ui(i,d){if(i&1){let e=ee();a(0,"div",20)(1,"cx-pagination",21),v("viewPageEvent",function(n){J(e);let c=y(3);return W(c.pageChange(n))}),s()()}if(i&2){let e=y(2).ngIf;o(),m("pagination",e.pagination)}}function Gi(i,d){if(i&1){let e=ee();O(0),a(1,"div",5)(2,"label",6)(3,"span"),p(4),r(5,"cxTranslate"),s(),a(6,"cx-sorting",7),r(7,"cxTranslate"),r(8,"async"),r(9,"cxTranslate"),v("sortListEvent",function(n){J(e);let c=y(2);return W(c.changeSortCode(n))}),s()(),T(10,"cx-customer-ticketing-create"),s(),a(11,"table",8)(12,"thead",9)(13,"tr")(14,"th",10),p(15),r(16,"cxTranslate"),s(),a(17,"th",10),p(18),r(19,"cxTranslate"),s(),a(20,"th",10),p(21),r(22,"cxTranslate"),s(),a(23,"th",10),p(24),r(25,"cxTranslate"),s(),a(26,"th",10),p(27),r(28,"cxTranslate"),s(),a(29,"th",10),p(30),r(31,"cxTranslate"),s()()(),a(32,"tbody"),f(33,Vi,45,71,"tr",11),s()(),a(34,"div",12),f(35,Ui,2,1,"div",13),s(),L()}if(i&2){let e=y().ngIf,t=y();o(4),u(" ",l(5,14,"customerTicketingList.sortSubtitle")," "),o(2),ge("placeholder",l(7,16,"customerTicketingList.sortSubtitle")),m("sortOptions",e.sorts)("sortLabels",l(8,18,t.getSortLabels()))("selectedOption",e.pagination==null?null:e.pagination.sort)("ariaLabel",l(9,20,"customerTicketingList.sortOrders")),o(9),z(l(16,22,"customerTicketing.ticketId")),o(3),u(" ",l(19,24,"customerTicketingList.subject")," "),o(3),u(" ",l(22,26,"customerTicketingList.ticketCategory")," "),o(3),z(l(25,28,"customerTicketing.createdOn")),o(3),z(l(28,30,"customerTicketing.changedOn")),o(3),z(l(31,32,"customerTicketing.status")),o(3),m("ngForOf",e.tickets),o(2),m("ngIf",(e.pagination==null?null:e.pagination.totalPages)>1)}}function Qi(i,d){i&1&&(T(0,"cx-customer-ticketing-create"),O(1),a(2,"div",22)(3,"h3"),p(4),r(5,"cxTranslate"),s()(),L()),i&2&&(o(4),z(l(5,1,"customerTicketingList.noTickets")))}function qi(i,d){if(i&1&&(O(0),a(1,"span",3)(2,"h2",4),p(3),r(4,"cxTranslate"),s()(),f(5,Gi,36,34,"ng-container",2)(6,Qi,6,3,"ng-template",null,1,ce),L()),i&2){let e=d.ngIf,t=re(7);o(3),He(" ",l(4,4,"customerTicketingList.requestTitle")," (",(e.pagination==null?null:e.pagination.totalResults)||0,") "),o(2),m("ngIf",e.tickets.length>0)("ngIfElse",t)}}function Ki(i,d){i&1&&T(0,"cx-spinner")}function Zi(i,d){if(i&1&&(O(0),a(1,"div",2)(2,"div",3)(3,"div",4),T(4,"cx-card",5),r(5,"async"),s(),a(6,"div",4),T(7,"cx-card",5),r(8,"cxDate"),r(9,"async"),s(),a(10,"div",4),T(11,"cx-card",5),r(12,"cxDate"),r(13,"async"),s(),a(14,"div",4),T(15,"cx-card",5),r(16,"async"),s()()(),L()),i&2){let e,t,n=d.ngIf,c=y();o(4),m("content",l(5,4,c.prepareCardContent(n.id,"customerTicketing.ticketId"))),o(3),m("content",l(9,9,c.prepareCardContent((e=I(8,6,n.createdAt,c.dateFormat))!==null&&e!==void 0?e:c.dateFormat,"customerTicketing.createdOn"))),o(4),m("content",l(13,14,c.prepareCardContent((t=I(12,11,n.modifiedAt,c.dateFormat))!==null&&t!==void 0?t:c.dateFormat,"customerTicketing.changedOn"))),o(4),m("content",l(16,16,c.prepareCardContent(n.status?n.status.name:void 0,"customerTicketing.status",n.status?n.status.id:void 0)))}}function zi(i,d){i&1&&T(0,"cx-spinner")}function Hi(i,d){if(i&1){let e=ee();a(0,"div",2)(1,"button",3,0),v("click",function(){J(e);let n=y();return W(n.openDialog())}),p(3),r(4,"cxTranslate"),s()()}i&2&&(o(3),u(" ",l(4,1,"customerTicketingDetails.reopenRequest")," "))}var Yi=()=>({cxRoute:"supportTickets"}),mi=i=>({value:i});function Xi(i,d){if(i&1&&(O(0),a(1,"div",9)(2,"span",10),r(3,"cxTranslate"),p(4),s(),a(5,"span",11),p(6),s(),a(7,"span",11),r(8,"cxTranslate"),p(9),r(10,"cxTranslate"),s()(),a(11,"div",11),p(12),r(13,"cxDate"),r(14,"cxTranslate"),s(),L()),i&2){let e=d.$implicit;o(2),$("aria-label",l(3,6,"myAccountV2CustomerTicketing.subjectLabel")),o(2),u(" ",e.subject," "),o(2),u(" | ",e.ticketCategory==null?null:e.ticketCategory.name," "),o(),$("aria-label",l(8,8,"myAccountV2CustomerTicketing.idLabel")),o(2),u(" | ",I(10,10,"myAccountV2CustomerTicketing.ticketId",x(19,mi,e.id))," "),o(3),u(" ",I(14,16,"myAccountV2CustomerTicketing.changedOn",x(21,mi,I(13,13,e.modifiedAt,"d, MMMM, yyyy")))," ")}}function Ji(i,d){if(i&1&&(O(0),a(1,"div",7),f(2,Xi,15,23,"ng-container",8),s(),L()),i&2){let e=y().ngIf;o(2),m("ngForOf",e.tickets)}}function Wi(i,d){if(i&1&&(O(0),f(1,Ji,3,1,"ng-container",6),L()),i&2){let e=d.ngIf;y();let t=re(15);o(),m("ngIf",e.tickets.length>0)("ngIfElse",t)}}function en(i,d){i&1&&(a(0,"div",12),r(1,"cxTranslate"),p(2),r(3,"cxTranslate"),s()),i&2&&($("aria-label",l(1,2,"customerTicketingList.noTickets")),o(2),u(" ",l(3,4,"customerTicketingList.noTickets")," "))}function tn(i,d){i&1&&T(0,"cx-spinner")}var di=(()=>{class i{constructor(){this.customerTicketingFacade=R(b)}enableCloseButton(){return this.customerTicketingFacade.getTicket().pipe(C(e=>(e?.status?.id==="OPEN"||e?.status?.id==="INPROCESS")&&e.availableStatusTransitions?.some(t=>t.id.toUpperCase()==="CLOSED")))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac})}}return i})(),nn=(()=>{class i{constructor(e,t,n){this.customerTicketingFacade=e,this.launchDialogService=t,this.vcr=n,this.subscription=new ne,this.customerTicketingCloseComponentService=R(di),this.enableCloseButton$=this.customerTicketingCloseComponentService.enableCloseButton()}openDialog(){let e=this.launchDialogService.openDialog("CUSTOMER_TICKETING_CLOSE",this.element,this.vcr);e&&this.subscription.add(e.pipe(q(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||i)(g(b),g(Ee),g(De))}}static{this.\u0275cmp=F({type:i,selectors:[["cx-customer-ticketing-close"]],viewQuery:function(t,n){if(t&1&&Te(lt,5),t&2){let c;he(c=Ce())&&(n.element=c.first)}},decls:2,vars:3,consts:[["element",""],["class","col-xs-12 col-md-5 col-lg-4",4,"ngIf"],[1,"col-xs-12","col-md-5","col-lg-4"],[1,"btn","btn-block","btn-secondary",3,"click"]],template:function(t,n){t&1&&(f(0,Fi,5,3,"div",1),r(1,"async")),t&2&&m("ngIf",l(1,1,n.enableCloseButton$))},dependencies:[P,V,G],encapsulation:2})}}return i})(),pt=(()=>{class i{get messagesCharacterLeft(){return this.inputCharactersLimit-(this.form.get("message")?.value?.length||0)}get subjectCharacterLeft(){return this.inputCharactersForSubject-(this.form.get("subject")?.value?.length||0)}get allowedTypes(){return this.customerTicketingConfig.customerTicketing?.attachmentRestrictions?.allowedTypes}get getInputCharactersLimit(){return this.customerTicketingConfig.customerTicketing?.inputCharactersLimit??Ht}get getInputCharactersForSubject(){return this.customerTicketingConfig.customerTicketing?.inputCharactersLimitForSubject??Yt}get maxSize(){return this.customerTicketingConfig.customerTicketing?.attachmentRestrictions?.maxSize??Xt}handleClick(e){e.target.tagName===this.el.nativeElement.tagName&&this.close("Click outside of the window")}constructor(e,t,n,c,h,N){this.launchDialogService=e,this.el=t,this.customerTicketingConfig=n,this.filesFormValidators=c,this.customerTicketingFacade=h,this.routingService=N,this.iconTypes=ot,this.inputCharactersLimit=this.getInputCharactersLimit,this.inputCharactersForSubject=this.getInputCharactersForSubject,this.isDataLoading$=new gt(!1),this.focusConfig={trap:!0,block:!0,autofocus:"button",focusOnEscape:!0}}buildForm(){let e=new it({});e.setControl("message",new X("",[Q.required,Q.maxLength(this.inputCharactersLimit)])),e.setControl("file",new X("",[this.filesFormValidators.maxSize(this.maxSize),this.filesFormValidators.maxEntries(st),this.filesFormValidators.allowedTypes(this.allowedTypes)])),this.form=e}close(e){this.launchDialogService.closeDialog(e)}static{this.\u0275fac=function(t){return new(t||i)(g(Ee),g(xt),g(Ze),g(Kt),g(b),g(te))}}static{this.\u0275dir=vt({type:i,hostBindings:function(t,n){t&1&&v("click",function(h){return n.handleClick(h)})}})}}return i})(),on=(()=>{class i extends pt{ngOnInit(){this.buildForm()}closeRequest(){this.form.invalid?(this.form.markAllAsTouched(),Ke.deepUpdateValueAndValidity(this.form)):(this.isDataLoading$.next(!0),this.subscription=this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent()).subscribe({complete:()=>{this.onComplete()},error:()=>{this.onError()}}))}prepareTicketEvent(){return{message:this.form?.get("message")?.value,toStatus:{id:"CLOSED",name:"Closed"}}}onComplete(){this.isDataLoading$.next(!1),this.close("Ticket closed successfully"),this.routingService.go({cxRoute:"supportTickets"})}onError(){this.close("Something went wrong while closing the ticket"),this.isDataLoading$.next(!1)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Ie(i)))(n||i)}})()}static{this.\u0275cmp=F({type:i,selectors:[["cx-customer-ticketing-close-dialog"]],features:[Me],decls:31,vars:32,consts:[["role","dialog","aria-labelledby","dialogTitle",1,"cx-customer-ticket-form-dialog",3,"esc","cxFocus"],[1,"cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],["id","dialogTitle",1,"cx-customer-ticket-form-title","modal-title"],[1,"cx-customer-ticket-form-close","close",3,"click","title"],["aria-hidden","true"],[3,"type"],[1,"cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-customer-ticket-input-hint"],[1,"cx-customer-ticket-form-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"],["class","overlay",4,"ngIf"],[1,"overlay"]],template:function(t,n){t&1&&(a(0,"div",0),v("esc",function(){return n.close("Escape clicked")}),a(1,"form",1)(2,"div",2)(3,"div",3),p(4),r(5,"cxTranslate"),s(),a(6,"button",4),r(7,"cxTranslate"),r(8,"cxTranslate"),v("click",function(){return n.close("Close Request Dialog")}),a(9,"span",5),T(10,"cx-icon",6),s()()(),a(11,"div",7)(12,"div",8)(13,"label")(14,"span",9),p(15),r(16,"cxTranslate"),s(),T(17,"textarea",10)(18,"cx-form-errors",11),a(19,"p",12),p(20),r(21,"cxTranslate"),s()()(),a(22,"div",13)(23,"button",14),v("click",function(){return n.close("Close Request Dialog")}),p(24),r(25,"cxTranslate"),s(),a(26,"button",15),v("click",function(){return n.closeRequest()}),p(27),r(28,"cxTranslate"),s()()(),f(29,Ai,1,0,"cx-spinner",16),r(30,"async"),s()()),t&2&&(m("cxFocus",n.focusConfig),o(),m("formGroup",n.form),o(3),u(" ",l(5,13,"customerTicketingDetails.closeRequest")," "),o(2),ge("title",l(7,15,"common.close")),$("aria-label",l(8,17,"common.close")),o(4),m("type",n.iconTypes.CLOSE),o(5),u(" ",l(16,19,"customerTicketing.message")," "),o(2),m("maxLength",n.inputCharactersLimit),o(),m("control",n.form.get("message")),o(2),u(" ",I(21,21,"customerTicketing.charactersLeft",x(30,ue,n.messagesCharacterLeft))," "),o(4),u(" ",l(25,24,"customerTicketing.cancel")," "),o(3),u(" ",l(28,26,"customerTicketing.submit")," "),o(2),m("ngIf",l(30,28,n.isDataLoading$)))},dependencies:[P,Ue,$e,je,Oe,Le,we,Ne,Be,Ge,ae,V,G],encapsulation:2})}}return i})(),rn=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({providers:[di,j({cmsComponents:{SupportTicketCloseComponent:{component:nn,guards:[ie]}}})],imports:[w,Y,ye,Pe,se,_e,Qe,le]})}}return i})(),cn=(()=>{class i extends pt{constructor(){super(...arguments),this.ticketCategories$=this.customerTicketingFacade.getTicketCategories().pipe(A(e=>{this.manageCategoryValidation(e)})),this.ticketAssociatedObjects$=this.customerTicketingFacade.getTicketAssociatedObjects().pipe(D(e=>(this.handleError(e),be([])))),this.globalMessage=R(Fe),this.translationService=R(H)}getCreateTicketPayload(e){return{message:e?.get("message")?.value,subject:e?.get("subject")?.value,associatedTo:e?.get("associatedTo")?.value||void 0,ticketCategory:e?.get("ticketCategory")?.value}}ngOnInit(){this.buildForm()}buildForm(){let e=new it({});e.setControl("subject",new X("",[Q.required,Q.maxLength(this.inputCharactersForSubject)])),e.setControl("ticketCategory",new X("",[Q.required])),e.setControl("associatedTo",new X("")),e.setControl("message",new X("",[Q.required,Q.maxLength(this.inputCharactersLimit)])),e.setControl("file",new X("",[this.filesFormValidators.maxSize(this.maxSize),this.filesFormValidators.maxEntries(st),this.filesFormValidators.allowedTypes(this.allowedTypes)])),this.form=e}createTicketRequest(){this.attachment=this.form.get("file")?.value?.[0],this.form.invalid?(this.form.markAllAsTouched(),Ke.deepUpdateValueAndValidity(this.form)):this.subscription=this.customerTicketingFacade.createTicket(this.getCreateTicketPayload(this.form)).subscribe({next:e=>{e.id&&this.attachment&&e.ticketEvents?.[0].code&&this.customerTicketingFacade.uploadAttachment(this.attachment,e.ticketEvents?.[0].code,e.id)},complete:()=>{this.onComplete()},error:e=>{this.handleError(e)}})}handleError(e){e instanceof It?(e.details??[]).forEach(t=>{t.message&&this.globalMessage.add({raw:t.message},ve.MSG_TYPE_ERROR)}):this.translationService.translate("httpHandlers.unknownError").pipe(kt()).subscribe(t=>{this.globalMessage.add({raw:t},ve.MSG_TYPE_ERROR)}),this.onError()}manageCategoryValidation(e){let t=this.form.get("ticketCategory");t&&(e?.length?(t.setValidators(Q.required),t.updateValueAndValidity()):(t.clearValidators(),t.updateValueAndValidity()))}onComplete(){this.close("Ticket created successfully")}onError(){this.close("Something went wrong")}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Ie(i)))(n||i)}})()}static{this.\u0275cmp=F({type:i,selectors:[["cx-customer-ticketing-create-dialog"]],inputs:{selectedCategory:"selectedCategory",selectedAssociatedObject:"selectedAssociatedObject"},features:[Me],decls:52,vars:58,consts:[["role","dialog","aria-labelledby","dialogTitle",1,"cx-customer-ticket-form-dialog",3,"esc","cxFocus"],[1,"cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],["id","dialogTitle",1,"cx-customer-ticket-form-title","modal-title"],["type","button",1,"cx-customer-ticket-form-close","close",3,"click","title"],["aria-hidden","true"],[3,"type"],[1,"cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","subject","rows","1",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-customer-ticket-input-hint"],[4,"ngIf"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],[3,"formControl","accept"],[1,"cx-customer-ticket-file-upload-hint"],["prefix","formErrors.file",3,"control"],[1,"cx-customer-ticket-form-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["formControlName","ticketCategory",1,"form-control"],["value","","disabled","","selected",""],[3,"ngValue","selected",4,"ngFor","ngForOf"],[3,"ngValue","selected"],["formControlName","associatedTo",1,"form-control"],[1,"cx-message-footer-text"]],template:function(t,n){t&1&&(a(0,"div",0),v("esc",function(){return n.close("Escape clicked")}),a(1,"form",1)(2,"div",2)(3,"div",3),p(4),r(5,"cxTranslate"),s(),a(6,"button",4),r(7,"cxTranslate"),r(8,"cxTranslate"),v("click",function(){return n.close("Close Create Request Dialog")}),a(9,"span",5),T(10,"cx-icon",6),s()()(),a(11,"div",7)(12,"div",8)(13,"label")(14,"span",9),p(15),r(16,"cxTranslate"),s(),T(17,"textarea",10)(18,"cx-form-errors",11),a(19,"p",12),p(20),r(21,"cxTranslate"),s()(),f(22,Li,10,8,"label",13),r(23,"async"),f(24,Ni,2,1,"ng-container",13),r(25,"async"),a(26,"label")(27,"span",9),p(28),r(29,"cxTranslate"),s(),T(30,"textarea",14)(31,"cx-form-errors",11),a(32,"p",12),p(33),r(34,"cxTranslate"),s()(),a(35,"div")(36,"cx-file-upload",15),f(37,Bi,4,4,"ng-template"),s(),a(38,"p",16),p(39),r(40,"cxTranslate"),s(),a(41,"p",16),p(42),r(43,"cxTranslate"),s(),T(44,"cx-form-errors",17),s()(),a(45,"div",18)(46,"button",19),v("click",function(){return n.close("Close Create Request Dialog")}),p(47),r(48,"cxTranslate"),s(),a(49,"button",20),v("click",function(){return n.createTicketRequest()}),p(50),r(51,"cxTranslate"),s()()()()()),t&2&&(m("cxFocus",n.focusConfig),o(),m("formGroup",n.form),o(3),u(" ",l(5,23,"createCustomerTicket.addNewRequest")," "),o(2),ge("title",l(7,25,"common.close")),$("aria-label",l(8,27,"common.close")),o(4),m("type",n.iconTypes.CLOSE),o(5),u(" ",l(16,29,"createCustomerTicket.subject")," "),o(2),m("maxLength",n.inputCharactersForSubject),o(),m("control",n.form.get("subject")),o(2),u(" ",I(21,31,"customerTicketing.charactersLeft",x(52,ue,n.subjectCharacterLeft))," "),o(2),m("ngIf",l(23,34,n.ticketCategories$)),o(2),m("ngIf",l(25,36,n.ticketAssociatedObjects$)),o(4),u(" ",l(29,38,"customerTicketing.message")," "),o(2),m("maxLength",n.inputCharactersLimit),o(),m("control",n.form.get("message")),o(2),u(" ",I(34,40,"customerTicketing.charactersLeft",x(54,ue,n.messagesCharacterLeft))," "),o(3),m("formControl",n.form.get("file"))("accept",n.allowedTypes),o(3),u(" ",I(40,43,"customerTicketing.fileSizeLimit",x(56,ue,n.maxSize))," "),o(3),u(" ",l(43,46,"customerTicketing.maximumAttachment")," "),o(2),m("control",n.form.get("file")),o(3),u(" ",l(48,48,"customerTicketing.cancel")," "),o(3),u(" ",l(51,50,"customerTicketing.submit")," "))},dependencies:[Re,P,Ue,$e,je,$t,Pt,Oe,Bt,Le,we,nt,Ne,Be,Ge,ct,V,G],encapsulation:2})}}return i})(),sn=(()=>{class i{constructor(e,t){this.launchDialogService=e,this.vcr=t,this.subscription=new ne}openCreateNewTicketDialog(){let e=this.launchDialogService.openDialog("CUSTOMER_TICKETING_CREATE",this.element,this.vcr);e&&this.subscription.add(e.pipe(q(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||i)(g(Ee),g(De))}}static{this.\u0275cmp=F({type:i,selectors:[["cx-customer-ticketing-create"]],viewQuery:function(t,n){if(t&1&&Te(lt,5),t&2){let c;he(c=Ce())&&(n.element=c.first)}},decls:4,vars:3,consts:[["element",""],[1,"btn","btn-primary","cx-customer-ticketing-create",3,"click"]],template:function(t,n){if(t&1){let c=ee();a(0,"button",1,0),v("click",function(){return J(c),W(n.openCreateNewTicketDialog())}),p(2),r(3,"cxTranslate"),s()}t&2&&(o(2),u(" ",l(3,1,"createCustomerTicket.addRequest"),`
`))},dependencies:[G],encapsulation:2})}}return i})(),gi=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({imports:[w,Y,ye,Pe,se,_e,Qe]})}}return i})(),an=(()=>{class i extends pt{ngOnInit(){this.buildForm()}reopenRequest(){if(this.form.invalid)this.form.markAllAsTouched(),Ke.deepUpdateValueAndValidity(this.form);else{let e=this.form.get("file")?.value?.length>0;this.isDataLoading$.next(!0),this.subscription=this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent(),e).subscribe({next:t=>{this.form.get("file")?.value?.length&&t.code&&this.customerTicketingFacade.uploadAttachment(this.form.get("file")?.value?.item(0),t.code)},complete:()=>{this.onComplete()},error:()=>{this.onError()}})}}onComplete(){this.isDataLoading$.next(!1),this.close("Ticket reopened successfully")}onError(){this.isDataLoading$.next(!1),this.close("Something went wrong while reopening ticket")}prepareTicketEvent(){return{message:this.form?.get("message")?.value,toStatus:{id:"INPROCESS",name:"INPROCESS"}}}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=Ie(i)))(n||i)}})()}static{this.\u0275cmp=F({type:i,selectors:[["cx-customer-ticketing-reopen-dialog"]],features:[Me],decls:41,vars:44,consts:[["role","dialog","aria-labelledby","dialogTitle",1,"cx-customer-ticket-form-dialog",3,"esc","cxFocus"],[1,"cx-customer-ticket-form-container",3,"formGroup"],[1,"modal-header","cx-customer-ticket-form-header"],["id","dialogTitle",1,"cx-customer-ticket-form-title","modal-title"],["type","button",1,"cx-customer-ticket-form-close","close",3,"click","title"],["aria-hidden","true"],[3,"type"],[1,"cx-customer-ticket-form-body"],[1,"cx-customer-ticket-form-row"],[1,"cx-customer-ticket-label","label-content"],["formControlName","message","rows","5",1,"form-control",3,"maxLength"],[3,"control"],[1,"cx-customer-ticket-input-hint"],[3,"formControl","accept"],[1,"cx-customer-ticket-file-upload-hint"],["prefix","formErrors.file",3,"control"],[1,"cx-customer-ticket-form-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["class","overlay",4,"ngIf"],[1,"cx-message-footer-text"],[1,"overlay"]],template:function(t,n){t&1&&(a(0,"div",0),v("esc",function(){return n.close("Escape clicked")}),a(1,"form",1)(2,"div",2)(3,"div",3),p(4),r(5,"cxTranslate"),s(),a(6,"button",4),r(7,"cxTranslate"),r(8,"cxTranslate"),v("click",function(){return n.close("Close Reopen Request Dialog")}),a(9,"span",5),T(10,"cx-icon",6),s()()(),a(11,"div",7)(12,"div",8)(13,"label")(14,"span",9),p(15),r(16,"cxTranslate"),s(),T(17,"textarea",10)(18,"cx-form-errors",11),a(19,"p",12),p(20),r(21,"cxTranslate"),s()()(),a(22,"div")(23,"cx-file-upload",13),f(24,$i,4,4,"ng-template"),s(),a(25,"p",14),p(26),r(27,"cxTranslate"),s(),a(28,"p",14),p(29),r(30,"cxTranslate"),s(),T(31,"cx-form-errors",15),s(),a(32,"div",16)(33,"button",17),v("click",function(){return n.close("Close Reopen Request Dialog")}),p(34),r(35,"cxTranslate"),s(),a(36,"button",18),v("click",function(){return n.reopenRequest()}),p(37),r(38,"cxTranslate"),s()()(),f(39,Pi,1,0,"cx-spinner",19),r(40,"async"),s()()),t&2&&(m("cxFocus",n.focusConfig),o(),m("formGroup",n.form),o(3),u(" ",l(5,18,"customerTicketingDetails.reopenRequest")," "),o(2),ge("title",l(7,20,"common.close")),$("aria-label",l(8,22,"common.close")),o(4),m("type",n.iconTypes.CLOSE),o(5),u(" ",l(16,24,"customerTicketing.message")," "),o(2),m("maxLength",n.inputCharactersLimit),o(),m("control",n.form.get("message")),o(2),u(" ",I(21,26,"customerTicketing.charactersLeft",x(40,ue,n.messagesCharacterLeft))," "),o(3),m("formControl",n.form.get("file"))("accept",n.allowedTypes),o(3),u(" ",I(27,29,"customerTicketing.fileSizeLimit",x(42,ue,n.maxSize))," "),o(3),u(" ",l(30,32,"customerTicketing.maximumAttachment")," "),o(2),m("control",n.form.get("file")),o(3),u(" ",l(35,34,"customerTicketing.cancel")," "),o(3),u(" ",l(38,36,"customerTicketing.submit")," "),o(2),m("ngIf",l(40,38,n.isDataLoading$)))},dependencies:[P,Ue,$e,je,Oe,Le,we,nt,Ne,Be,Ge,ct,ae,V,G],encapsulation:2})}}return i})(),ln={launch:{CUSTOMER_TICKETING_REOPEN:{inline:!0,component:an,dialogType:Ve.DIALOG},CUSTOMER_TICKETING_CLOSE:{inline:!0,component:on,dialogType:Ve.DIALOG},CUSTOMER_TICKETING_CREATE:{inline:!0,component:cn,dialogType:Ve.DIALOG}}},pn=(()=>{class i{constructor(e,t,n,c){this.customerTicketingFacade=e,this.routingService=t,this.translationService=n,this.customerTicketingConfig=c,this.PAGE_SIZE=this.customerTicketingConfig.customerTicketing?.listViewPageSize||5,this.iconTypes=ot,this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE).pipe(A(h=>this.sortType=h?.pagination?.sort||"")),this.getStatusClass=h=>{switch(h){case"OPEN":case"INPROCESS":return"cx-text-green";case"CLOSED":return"cx-text-grey";default:return""}}}goToTicketDetail(e){this.routingService.go({cxRoute:"supportTicketDetails",params:{ticketCode:e}})}getSortLabels(){return oe([this.translationService.translate("customerTicketing.ticketId"),this.translationService.translate("customerTicketing.changedOn")]).pipe(C(([e,t])=>({byTicketId:e,byDate:t})))}changeSortCode(e){this.sortType=e,this.pageChange(0)}pageChange(e){let t=this.createTicketListEvent(this.sortType,e);this.fetchTicketList(t)}createTicketListEvent(e,t){return{currentPage:t,sortCode:e}}fetchTicketList(e){this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE,e.currentPage,e.sortCode)}static{this.\u0275fac=function(t){return new(t||i)(g(b),g(te),g(H),g(Ze))}}static{this.\u0275cmp=F({type:i,selectors:[["cx-customer-ticketing-list"]],decls:4,vars:4,consts:[["spinner",""],["noCustomerTickets",""],[4,"ngIf","ngIfElse"],[1,"cx-ticketing-list-title"],[1,"cx-ticketing-list-title-text"],[1,"cx-ticketing-list-sort","top"],[1,"cx-ticketing-list-form-group","form-group"],["ariaControls","ticketing-list-table",3,"sortListEvent","sortOptions","sortLabels","selectedOption","placeholder","ariaLabel"],["id","ticketing-list-table","aria-hidden","true",1,"table","cx-ticketing-list-table"],[1,"cx-ticketing-list-thead-mobile"],["scope","col"],[3,"click",4,"ngFor","ngForOf"],[1,"cx-ticketing-list-sort","bottom"],["class","cx-ticketing-list-pagination",4,"ngIf"],[3,"click"],[1,"cx-ticketing-list-data","cx-ticketing-list-id"],[1,"cx-ticketing-list-label"],[1,"cx-ticketing-list-value",3,"routerLink"],[1,"cx-ticketing-list-data"],[1,"cx-ticketing-list-value",3,"routerLink","ngClass"],[1,"cx-ticketing-list-pagination"],[3,"viewPageEvent","pagination"],[1,"text-center"]],template:function(t,n){if(t&1&&(f(0,qi,8,6,"ng-container",2),r(1,"async"),f(2,Ki,1,0,"ng-template",null,0,ce)),t&2){let c=re(3);m("ngIf",l(1,2,n.tickets$))("ngIfElse",c)}},dependencies:[sn,_t,Re,P,Gt,Qt,Xe,ae,V,G,Ae,et],encapsulation:2})}}return i})(),mn=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({providers:[j({cmsComponents:{SupportTicketHistoryComponent:{component:pn,guards:[ie]}}})],imports:[gi,w,Y,xe,rt,ye,qt,Je,le]})}}return i})(),un=(()=>{class i{constructor(e,t,n,c){this.translation=e,this.customerTicketingFacade=t,this.routingService=n,this.eventService=c,this.dateFormat=Jt,this.subscription=new ne,this.ticketDetails$=this.customerTicketingFacade.getTicket(),this.reloadOnRedirection()}prepareCardContent(e,t,n){return this.translation.translate(t).pipe(ht(()=>!!e),C(c=>({title:c,text:[e||""],customClass:this.getStatusClass(n?.toUpperCase())})))}getStatusClass(e){return e==="OPEN"||e==="INPROCESS"?"cx-text-green":e==="CLOSED"?"cx-text-grey":""}reloadOnRedirection(){this.subscription=oe([this.ticketDetails$,this.routingService.getParams().pipe(C(e=>e.ticketCode))]).pipe(q(1),A(([e,t])=>{e&&t!==e?.id&&this.eventService.dispatch({},ze)})).subscribe()}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||i)(g(H),g(b),g(te),g(ke))}}static{this.\u0275cmp=F({type:i,selectors:[["cx-customer-ticketing-details"]],decls:4,vars:4,consts:[["spinner",""],[4,"ngIf","ngIfElse"],[1,"cx-ticket-details"],[1,"container"],[1,"cx-details-card"],[3,"content"]],template:function(t,n){if(t&1&&(f(0,Zi,17,18,"ng-container",1),r(1,"async"),f(2,zi,1,0,"ng-template",null,0,ce)),t&2){let c=re(3);m("ngIf",l(1,2,n.ticketDetails$))("ngIfElse",c)}},dependencies:[P,Ut,ae,V,Ae],encapsulation:2,changeDetection:0})}}return i})(),dn=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({providers:[j({cmsComponents:{SupportTicketDetailsComponent:{component:un,guards:[ie]}}})],imports:[w,Y,xe,rt,le]})}}return i})(),Ti=(()=>{class i{constructor(){this.customerTicketingFacade=R(b)}enableReopenButton(){return this.customerTicketingFacade.getTicket().pipe(C(e=>e?.status?.id==="CLOSED"&&e.availableStatusTransitions?.some(t=>t.id.toUpperCase()==="INPROCESS"||t.id.toUpperCase()==="OPEN")))}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac})}}return i})(),gn=(()=>{class i{constructor(e,t,n){this.customerTicketingFacade=e,this.launchDialogService=t,this.vcr=n,this.subscription=new ne,this.CustomerTicketingReopenComponentService=R(Ti),this.enableReopenButton$=this.CustomerTicketingReopenComponentService.enableReopenButton()}openDialog(){let e=this.launchDialogService.openDialog("CUSTOMER_TICKETING_REOPEN",this.element,this.vcr);e&&this.subscription.add(e.pipe(q(1)).subscribe())}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||i)(g(b),g(Ee),g(De))}}static{this.\u0275cmp=F({type:i,selectors:[["cx-customer-ticketing-reopen"]],viewQuery:function(t,n){if(t&1&&Te(lt,5),t&2){let c;he(c=Ce())&&(n.element=c.first)}},decls:2,vars:3,consts:[["element",""],["class","col-xs-12 col-md-5 col-lg-4",4,"ngIf"],[1,"col-xs-12","col-md-5","col-lg-4"],[1,"btn","btn-block","btn-secondary",3,"click"]],template:function(t,n){t&1&&(f(0,Hi,5,3,"div",1),r(1,"async")),t&2&&m("ngIf",l(1,1,n.enableReopenButton$))},dependencies:[P,V,G],encapsulation:2})}}return i})(),Tn=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({providers:[Ti,j({cmsComponents:{SupportTicketReopenComponent:{component:gn,guards:[ie]}}})],imports:[w,Y,ye,Pe,se,_e,Qe,le]})}}return i})(),hi=(()=>{class i{displayAddMessageSection(e){return e?.status?.id!=="CLOSED"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac})}}return i})(),hn=(()=>{class i{constructor(e,t,n){this.customerTicketingConfig=e,this.customerTicketingFacade=t,this.eventService=n,this.customerTicketingMessagesComponentService=R(hi),this.ticketDetails$=this.customerTicketingFacade.getTicket(),this.subscription=new ne,this.messageEvents$=this.prepareMessageEvents(),this.messagingConfigs=this.prepareMessagingConfigs()}onSend(e){let t=(e.files instanceof FileList&&e.files?.length>0)??!1;this.subscription.add(this.customerTicketingFacade.createTicketEvent(this.prepareTicketEvent(e.message),t).subscribe(n=>{e.files&&e.files?.length&&n.code&&this.customerTicketingFacade.uploadAttachment(e.files.item(0),n.code),this.messagingComponent?.resetForm()}))}downloadAttachment(e){this.subscription.add(this.customerTicketingFacade.downloadAttachment(e.messageCode,e.attachmentId).subscribe(t=>{let n=window.URL.createObjectURL(t),c=document.createElement("a");c.href=n,c.download=e.fileName??"",c.click()}))}prepareMessageEvents(){return this.ticketDetails$.pipe(C(e=>e?.ticketEvents?.map(t=>dt(ut({},t),{text:t.message??"",rightAlign:t.addedByAgent||!1,attachments:t.ticketEventAttachments??[]}))??[]))}prepareMessagingConfigs(){return{attachmentRestrictions:this.customerTicketingConfig.customerTicketing?.attachmentRestrictions,charactersLimit:this.customerTicketingConfig.customerTicketing?.inputCharactersLimit,enableFileUploadOption:!0,displayAddMessageSection:this.ticketDetails$.pipe(C(e=>this.customerTicketingMessagesComponentService.displayAddMessageSection(e)))}}prepareTicketEvent(e){return{message:e}}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||i)(g(Ze),g(b),g(ke))}}static{this.\u0275cmp=F({type:i,selectors:[["cx-customer-ticketing-messages"]],viewQuery:function(t,n){if(t&1&&Te(qe,5),t&2){let c;he(c=Ce())&&(n.messagingComponent=c.first)}},decls:1,vars:2,consts:[[3,"send","downloadAttachment","messageEvents$","messagingConfigs"]],template:function(t,n){t&1&&(a(0,"cx-messaging",0),v("send",function(h){return n.onSend(h)})("downloadAttachment",function(h){return n.downloadAttachment(h)}),s()),t&2&&m("messageEvents$",n.messageEvents$)("messagingConfigs",n.messagingConfigs)},dependencies:[qe],encapsulation:2})}}return i})(),Cn=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({providers:[hi,j({cmsComponents:{SupportTicketUpdateComponent:{component:hn,guards:[ie]}}})],imports:[w,Y,xe,Zt,se,Vt]})}}return i})(),fn=(()=>{class i{constructor(){this.PAGE_SIZE=1,this.customerTicketingFacade=R(b),this.tickets$=this.customerTicketingFacade.getTickets(this.PAGE_SIZE)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=F({type:i,selectors:[["cx-my-account-v2-customer-ticketing"]],decls:18,vars:20,consts:[["noCustomerTickets",""],["spinner",""],[1,"cx-my-account-customer-ticket-header"],[1,"cx-my-account-customer-ticket-heading"],[1,"cx-my-account-customer-ticket-show-more"],["id","show-more-requests",1,"btn-link","cx-action-link",3,"routerLink"],[4,"ngIf","ngIfElse"],[1,"cx-my-account-customer-ticket-body"],[4,"ngFor","ngForOf"],[1,"cx-my-account-customer-ticket-details"],[1,"cx-my-account-customer-ticket-subject"],[1,"cx-my-account-customer-ticket-details-light"],[1,"cx-my-account-no-ticket"]],template:function(t,n){if(t&1&&(O(0),a(1,"div",2)(2,"div",3),r(3,"cxTranslate"),p(4),r(5,"cxTranslate"),s(),a(6,"div",4)(7,"a",5),r(8,"cxUrl"),r(9,"cxTranslate"),p(10),r(11,"cxTranslate"),s()()(),f(12,Wi,2,2,"ng-container",6),r(13,"async"),L(),f(14,en,4,6,"ng-template",null,0,ce)(16,tn,1,0,"ng-template",null,1,ce)),t&2){let c=re(17);o(2),$("aria-label",l(3,7,"myAccountV2CustomerTicketing.heading")),o(2),u(" ",l(5,9,"myAccountV2CustomerTicketing.heading")," "),o(3),m("routerLink",l(8,11,yt(19,Yi))),$("aria-label",l(9,13,"myAccountV2CustomerTicketing.showMore")),o(3),u(" ",l(11,15,"myAccountV2CustomerTicketing.showMore")," "),o(2),m("ngIf",l(13,17,n.tickets$))("ngIfElse",c)}},dependencies:[Re,P,ae,Xe,V,G,Ae,et],encapsulation:2})}}return i})(),kn=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({providers:[j({cmsComponents:{MyAccountViewRequestsComponent:{component:fn,guards:[ie]}}})],imports:[w,Y,xe,le,Je]})}}return i})(),Ci=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({providers:[j(ln)],imports:[se,_e,dn,rn,Tn,mn,Cn,gi,kn]})}}return i})();var Se=class{},xi=(()=>{class i{constructor(e){this.adapter=e}getTicket(e,t){return this.adapter.getTicket(e,t)}getTickets(e,t,n,c){return this.adapter.getTickets(e,t,n,c)}getTicketCategories(){return this.adapter.getTicketCategories()}getTicketAssociatedObjects(e){return this.adapter.getTicketAssociatedObjects(e)}createTicket(e,t){return this.adapter.createTicket(e,t)}createTicketEvent(e,t,n){return this.adapter.createTicketEvent(e,t,n)}uploadAttachment(e,t,n,c){return this.adapter.uploadAttachment(e,t,n,c)}downloadAttachment(e,t,n,c){return this.adapter.downloadAttachment(e,t,n,c)}static{this.\u0275fac=function(t){return new(t||i)(k(Se))}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac})}}return i})(),Ei=new Z("CustomerTicketingDetailsNormalizer"),yi=new Z("CustomerTicketingEventNormalizer"),mt=new Z("CustomerTicketingFileNormalizer"),_i=new Z("CustomerTicketingListNormalizer"),Si=new Z("CustomerTicketingCategoryNormalizer"),bi=new Z("CustomerTicketingAssociatedObjectsNormalizer"),Ii=new Z("CustomerTicketingCreateNormalizer"),fi=(()=>{class i{getTicketCategoriesQueryReloadEvents(){return[ci]}getTicketCategoriesQueryResetEvents(){return[ri]}getTicketAssociatedObjectsQueryReloadEvents(){return[ai]}getTicketAssociatedObjectsQueryResetEvents(){return[si]}getTicketQueryReloadEvents(){return[ze]}getTicketQueryResetEvents(){return[Wt]}getTicketsQueryReloadEvents(){return[ti]}getTicketsQueryResetEvents(){return[ei]}getTicketsQuery$(e,t,n){return this.queryService.create(()=>this.customerTicketingListPreConditions().pipe(K(c=>this.customerTicketingConnector.getTickets(c,e,t,n))),{reloadOn:this.getTicketsQueryReloadEvents(),resetOn:this.getTicketsQueryResetEvents()})}customerTicketingPreConditions(){return oe([this.userIdService.getUserId(),this.routingService.getParams().pipe(C(e=>e.ticketCode),ft())]).pipe(q(1),C(([e,t])=>{if(!e)throw new Error("Customer ticketing pre conditions not met");return[e,t]}))}customerTicketingListPreConditions(){return this.userIdService.getUserId().pipe(q(1),C(e=>{if(!e)throw new Error("Customer ticketing list pre conditions not met");return e}))}constructor(e,t,n,c,h,N){this.queryService=e,this.commandService=t,this.userIdService=n,this.customerTicketingConnector=c,this.routingService=h,this.eventService=N,this.createTicketCommand=this.commandService.create(E=>this.customerTicketingPreConditions().pipe(K(([B])=>this.customerTicketingConnector.createTicket(B,E)),A(()=>{this.eventService.dispatch({},li)})),{strategy:fe.Queue}),this.createTicketEventCommand=this.commandService.create(E=>this.customerTicketingPreConditions().pipe(K(([B,de])=>this.customerTicketingConnector.createTicketEvent(B,de,E.ticketEvent).pipe(A(()=>{E.ticketEvent.toStatus?.id==="CLOSED"?this.eventService.dispatch({},oi):E.containsAttachment||(E.ticketEvent.toStatus?.id==="OPEN"||E.ticketEvent.toStatus?.id==="INPROCESS"?this.eventService.dispatch({},ni):this.eventService.dispatch({},ii))})))),{strategy:fe.Queue}),this.uploadAttachmentCommand=this.commandService.create(E=>this.customerTicketingPreConditions().pipe(K(([B,de])=>this.customerTicketingConnector.uploadAttachment(B,E.ticketId??de,E.eventCode,E.file).pipe(A(()=>this.eventService.dispatch({},pi))))),{strategy:fe.Queue}),this.downloadAttachmentCommand=this.commandService.create(E=>this.customerTicketingPreConditions().pipe(K(([B,de])=>this.customerTicketingConnector.downloadAttachment(B,de,E.eventCode,E.attachmentId))),{strategy:fe.Queue}),this.getTicketQuery$=this.queryService.create(()=>this.customerTicketingPreConditions().pipe(K(([E,B])=>this.customerTicketingConnector.getTicket(E,B))),{reloadOn:this.getTicketQueryReloadEvents(),resetOn:this.getTicketQueryResetEvents()}),this.getTicketCategoriesQuery=this.queryService.create(()=>this.customerTicketingConnector.getTicketCategories(),{reloadOn:this.getTicketCategoriesQueryReloadEvents(),resetOn:this.getTicketCategoriesQueryResetEvents()}),this.getTicketAssociatedObjectsQuery=this.queryService.create(()=>this.customerTicketingPreConditions().pipe(K(([E])=>this.customerTicketingConnector.getTicketAssociatedObjects(E))),{reloadOn:this.getTicketAssociatedObjectsQueryReloadEvents(),resetOn:this.getTicketAssociatedObjectsQueryResetEvents()})}getTicketAssociatedObjectsState(){return this.getTicketAssociatedObjectsQuery.getState()}getTicketAssociatedObjects(){return this.getTicketAssociatedObjectsState().pipe(Ct(e=>e?.error?Tt(e.error):be(e)),C(e=>e.data??[]))}getTicketCategoriesState(){return this.getTicketCategoriesQuery.getState()}getTicketCategories(){return this.getTicketCategoriesState().pipe(C(e=>e.data??[]))}getTicketState(){return this.getTicketQuery$.getState()}getTicket(){return this.getTicketState().pipe(C(e=>e.data))}createTicket(e){return this.createTicketCommand.execute(e)}getTicketsState(e,t,n){return this.getTicketsQuery$(e,t,n).getState()}getTickets(e,t,n){return this.getTicketsState(e,t,n).pipe(C(c=>c.data))}createTicketEvent(e,t=!1){return this.createTicketEventCommand.execute({ticketEvent:e,containsAttachment:t})}uploadAttachment(e,t,n){return this.uploadAttachmentCommand.execute({file:e,eventCode:t,ticketId:n})}downloadAttachment(e,t){return this.downloadAttachmentCommand.execute({eventCode:e,attachmentId:t})}static{this.\u0275fac=function(t){return new(t||i)(k(Ot),k(At),k(Dt),k(xi),k(te),k(ke))}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac})}}return i})(),vn=[fi,{provide:b,useExisting:fi}];function ki(i){return i.reason==="notFound"&&i.type==="NotFoundError"}var xn=(()=>{class i extends tt{constructor(e,t,n){super(e,n),this.globalMessageService=e,this.routingService=t,this.platformId=n,this.responseStatus=Nt.NOT_FOUND}getPriority(){return 0}hasMatch(e){return super.hasMatch(e)&&this.isCustomerTicketingDetailsRoute()&&this.getErrors(e).some(ki)}handleError(e,t){this.handleTicketNotFoundError(e,t)}isCustomerTicketingDetailsRoute(){return Lt(this.routingService.getRouterState())?.state?.semanticRoute==="supportTicketDetails"}handleTicketNotFoundError(e,t){this.getErrors(t).filter(n=>ki(n)).forEach(()=>{this.routingService.go({cxRoute:"supportTickets"}),this.globalMessageService.add({key:"customerTicketingDetails.ticketNotFound"},ve.MSG_TYPE_ERROR)})}getErrors(e){return e.error?.errors||[]}static{this.\u0275fac=function(t){return new(t||i)(k(Fe),k(te),k(Et))}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),vi=(()=>{class i extends We{constructor(e,t,n,c,h,N){super(),this.translationService=e,this.activeCartFacade=t,this.basePageMetaResolver=n,this.customerTicketingFacade=c,this.translation=h,this.semanticPath=N,this.CUSTOMER_SERVICE_TRANSLATION_KEY="customerTicketing.customerService",this.CUSTOMER_SERVICE_SEMANTIC_ROUTE="supportTickets",this.customerServiceBreadCrumb$=this.translation.translate(this.CUSTOMER_SERVICE_TRANSLATION_KEY).pipe(C(E=>[{label:E,link:this.semanticPath.get(this.CUSTOMER_SERVICE_SEMANTIC_ROUTE)}])),this.pageType=bt.CONTENT_PAGE,this.pageUid="support-ticket-details"}resolveTitle(){return this.basePageMetaResolver.resolveTitle()}resolveHeading(){return this.customerTicketingFacade.getTicket().pipe(C(e=>e?.subject||""))}resolveDescription(){return this.basePageMetaResolver.resolveDescription()}resolveRobots(){return this.basePageMetaResolver.resolveRobots()}resolveBreadcrumbs(){return oe([this.customerServiceBreadCrumb$,this.basePageMetaResolver.resolveBreadcrumbs()]).pipe(C(([e,t=[]])=>{let[n,...c]=t;return[n,...e,...c]}))}static{this.\u0275fac=function(t){return new(t||i)(k(H),k(zt),k(jt),k(b),k(H),k(Rt))}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Di=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({providers:[...vn,xi,vi,{provide:tt,useExisting:xn,multi:!0},{provide:We,useExisting:vi,multi:!0}]})}}return i})();var En=(()=>{class i{constructor(e,t,n){this.http=e,this.occEndpoints=t,this.converter=n,this.logger=R(Mt)}getTicketAssociatedObjects(e){return this.http.get(this.getTicketAssociatedObjectsEndpoint(e)).pipe(D(t=>{throw U(t,this.logger)}),C(t=>t.ticketAssociatedObjects??[]),this.converter.pipeableMany(bi))}getTicketAssociatedObjectsEndpoint(e){return this.occEndpoints.buildUrl("getTicketAssociatedObjects",{urlParams:{customerId:e}})}getTicketCategories(){return this.http.get(this.getTicketCategoriesEndpoint()).pipe(D(e=>{throw U(e,this.logger)}),C(e=>e.ticketCategories??[]),this.converter.pipeableMany(Si))}getTicketCategoriesEndpoint(){return this.occEndpoints.buildUrl("getTicketCategories")}getTicket(e,t){return this.http.get(this.getTicketEndpoint(e,t)).pipe(D(n=>{throw U(n,this.logger)}),A(n=>n.ticketEvents?.reverse()),this.converter.pipeable(Ei))}getTicketEndpoint(e,t){return this.occEndpoints.buildUrl("getTicket",{urlParams:{customerId:e,ticketId:t}})}createTicket(e,t){return this.http.post(this.getCreateTicketEndpoint(e),t,{headers:new Ye().set("Content-Type","application/json")}).pipe(D(n=>{throw U(n,this.logger)}),this.converter.pipeable(Ii))}getCreateTicketEndpoint(e){return this.occEndpoints.buildUrl("createTicket",{urlParams:{customerId:e}})}getTickets(e,t,n,c){return this.http.get(this.getTicketsEndpoint(e,t,n,c)).pipe(D(h=>{throw U(h,this.logger)}),this.converter.pipeable(_i))}getTicketsEndpoint(e,t,n,c){return this.occEndpoints.buildUrl("getTickets",{urlParams:{customerId:e},queryParams:{pageSize:t,currentPage:n,sort:c}})}createTicketEvent(e,t,n){return this.http.post(this.getCreateTicketEventEndpoint(e,t),n,{headers:new Ye().set("Content-Type","application/json")}).pipe(D(c=>{throw U(c,this.logger)}),this.converter.pipeable(yi))}getCreateTicketEventEndpoint(e,t){return this.occEndpoints.buildUrl("createTicketEvent",{urlParams:{customerId:e,ticketId:t}})}uploadAttachment(e,t,n,c){let h=new FormData;return h.append("ticketEventAttachment",c),this.http.post(this.getUploadAttachmentEndpoint(e,t,n),h).pipe(D(N=>{throw U(N,this.logger)}),this.converter.pipeable(mt))}getUploadAttachmentEndpoint(e,t,n){return this.occEndpoints.buildUrl("uploadAttachment",{urlParams:{customerId:e,ticketId:t,eventCode:n}})}downloadAttachment(e,t,n,c){let h={responseType:"blob"};return this.http.get(this.getDownloadAttachmentEndpoint(e,t,n,c),h).pipe(D(N=>{throw U(N,this.logger)}),this.converter.pipeable(mt))}getDownloadAttachmentEndpoint(e,t,n,c){return this.occEndpoints.buildUrl("downloadAttachment",{urlParams:{customerId:e,ticketId:t,eventCode:n,attachmentId:c}})}static{this.\u0275fac=function(t){return new(t||i)(k(St),k(Ft),k(wt))}}static{this.\u0275prov=M({token:i,factory:i.\u0275fac})}}return i})(),yn={backend:{occ:{endpoints:{getTicket:"users/${customerId}/tickets/${ticketId}",getTickets:"users/${customerId}/tickets",createTicketEvent:"users/${customerId}/tickets/${ticketId}/events",getTicketCategories:"/ticketCategories",getTicketAssociatedObjects:"users/${customerId}/ticketAssociatedObjects",createTicket:"users/${customerId}/tickets",uploadAttachment:"/users/${customerId}/tickets/${ticketId}/events/${eventCode}/attachments",downloadAttachment:"/users/${customerId}/tickets/${ticketId}/events/${eventCode}/attachments/${attachmentId}"}}}},Mi=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({providers:[j(yn),{provide:Se,useClass:En}],imports:[w]})}}return i})();var Co=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=S({type:i})}static{this.\u0275inj=_({imports:[Ci,Di,Mi]})}}return i})();export{Co as CustomerTicketingModule};

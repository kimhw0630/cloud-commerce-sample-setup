import './polyfills.server.mjs';
import{c as fe}from"./chunk-LZ45RK54.mjs";import{Q as ge,Y as k,ja as y}from"./chunk-EKK5QDHO.mjs";import{$ as b,Aa as h,Da as H,F as L,Fa as F,Ha as O,J as C,Jc as le,Kc as l,Nb as ce,Ob as ue,Rb as de,Sb as he,W as ie,X as re,_ as d,ca as se,f as D,ha as _,ia as U,ja as p,oa as M,pa as P,pb as $,qb as x,rb as W,sa as N,ta as oe,ua as ne,za as ae}from"./chunk-H5UHAHI5.mjs";import{Fa as a,Ga as S,Ka as s,Md as te,Sa as v,T as Z,Tc as q,X as w,ab as Q,ae as A,g as K,p as B,pd as ee,q as R,u as X,x as E,xa as J,y as j}from"./chunk-TXWRNZDJ.mjs";import{a as V,j as Y,k as T}from"./chunk-GHFNAT2I.mjs";var Ke=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:function(i){let r=null;return i?r=new(i||e):r=s(L),r},providedIn:"root"})}}return e})(),Se="asm_enabled",ve=(()=>{class e{constructor(t,i,r,n){this.location=t,this.winRef=i,this.launchDialogService=r,this.featureModules=n}load(){this.isEnabled()&&this.addUi()}isEnabled(){return this.isLaunched()&&!this.isUsedBefore()&&this.winRef.localStorage&&this.winRef.localStorage.setItem(Se,"true"),this.isLaunched()||this.isUsedBefore()||this.isEmulateInURL()}isLaunched(){let t=this.location.path().split("?")[1];return!!t&&t.split("&").includes("asm=true")}isEmulateInURL(){return this.location.path().indexOf("assisted-service/emulate?")>0}isUsedBefore(){return this.winRef.localStorage?this.winRef.localStorage.getItem(Se)==="true":!1}addUi(){this.featureModules.resolveFeature("asm").subscribe(()=>this.launchDialogService.launch("ASM"))}static{this.\u0275fac=function(i){return new(i||e)(s(ee),s(_),s(ge),s(le))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ie=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=v({type:e})}static{this.\u0275inj=S({providers:[{provide:q,useFactory:Te,deps:[ve],multi:!0}],imports:[te,y]})}}return e})();function Te(e){return()=>{e.load()}}var m=function(e){return e.START_SESSION="START_SESSION",e.ORDER_HISTORY="ORDER_HISTORY",e.ACTIVE_CART="ACTIVE_CART",e.CUSTOMER_360="CUSTOMER_360",e}(m||{}),Re={asm:{agentSessionTimer:{startingDelayInSeconds:600},customerSearch:{maxResults:20},customerList:{pageSize:5,showAvatar:!0,columns:[{headerLocalizationKey:"asm.customerList.tableHeader.customer",renderer:e=>e?.name??"",actionType:m.START_SESSION},{headerLocalizationKey:"asm.customerList.tableHeader.email",renderer:e=>e?.uid??""},{headerLocalizationKey:"asm.customerList.tableHeader.phone",renderer:e=>e?.defaultAddress?.phone??""},{headerLocalizationKey:"asm.customerList.tableHeader.account",renderer:e=>e?.orgUnit?.name??""},{headerLocalizationKey:"asm.customerList.tableHeader.activeCart",icon:{symbol:k.CART,captionLocalizationKey:"asm.customerList.tableHeader.viewActiveCart"},actionType:m.ACTIVE_CART},{headerLocalizationKey:"asm.customerList.tableHeader.orders",icon:{symbol:k.C360_INVOICE,captionLocalizationKey:"asm.customerList.tableHeader.viewOrders"},actionType:m.ORDER_HISTORY},{headerLocalizationKey:"asm.customerList.tableHeader.customer360",icon:{symbol:k.C360_CIRCLE_USER,captionLocalizationKey:"asm.customerList.tableHeader.viewCustomer360"},actionType:m.CUSTOMER_360}]},userIdHttpHeader:{enable:!0}}},Ee=(()=>{class e{constructor(t,i,r){this.config=t,this.userIdService=i,this.userIdConstants=r,this.userIdHeader="sap-commerce-cloud-user-id",this.uniqueUserIdConstants=new Set(Object.values(r))}intercept(t,i){if(!this.config.asm?.userIdHttpHeader?.enable)return i.handle(t);let r=t.context.get(ce),n;if(typeof r.sendUserIdAsHeader=="string")n=R(r.sendUserIdAsHeader);else if(r.sendUserIdAsHeader)n=this.userIdService.takeUserId().pipe(E(o=>this.uniqueUserIdConstants.has(o)?void 0:o));else return i.handle(t);return n.pipe(Z(o=>{if(o){let u=t.clone({headers:t.headers.set(this.userIdHeader,o)});return i.handle(u)}else return i.handle(t)}))}static{this.\u0275fac=function(i){return new(i||e)(s(L),s(b),s(ue))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),c=function(e){return e.CSAgent="CSAgent",e.User="User",e}(c||{}),z=(()=>{class e extends p{constructor(){super(...arguments),this._tokenTarget$=new K(c.User)}getTokenTarget(){return this._tokenTarget$}setTokenTarget(t){this._tokenTarget$.next(t)}getEmulatedUserToken(){return this.emulatedUserToken}setEmulatedUserToken(t){this.emulatedUserToken=t}switchTokenTargetToCSAgent(){this._tokenTarget$.next(c.CSAgent)}switchTokenTargetToUser(){this._tokenTarget$.next(c.User)}clearEmulatedUserToken(){this.emulatedUserToken=void 0}static{this.\u0275fac=(()=>{let t;return function(r){return(t||(t=Q(e)))(r||e)}})()}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ae=(()=>{class e{constructor(t,i,r,n,o,u){this.authService=t,this.authStorageService=i,this.userIdService=r,this.oAuthLibWrapperService=n,this.store=o,this.userAccountFacade=u}authorizeCustomerSupportAgent(t,i){return T(this,null,function*(){let r,n;this.userAccountFacade.get().subscribe(o=>n=o?.customerId).unsubscribe(),this.authStorageService.getToken().subscribe(o=>r=o).unsubscribe(),this.authStorageService.switchTokenTargetToCSAgent();try{yield this.oAuthLibWrapperService.authorizeWithPasswordFlow(t,i),this.store.dispatch(new d.Logout),n!==void 0&&r!==void 0?(this.userIdService.setUserId(n),this.authStorageService.setEmulatedUserToken(r),this.store.dispatch(new d.Login)):(this.userIdService.setUserId(re),this.authStorageService.clearEmulatedUserToken())}catch{this.authStorageService.switchTokenTargetToUser()}})}startCustomerEmulationSession(t){this.authStorageService.clearEmulatedUserToken(),this.store.dispatch(new d.Logout),this.userIdService.setUserId(t),this.store.dispatch(new d.Login)}isCustomerSupportAgentLoggedIn(){return j([this.authStorageService.getToken(),this.authStorageService.getTokenTarget()]).pipe(E(([t,i])=>!!(t?.access_token&&i===c.CSAgent)))}isCustomerEmulated(){return this.userIdService.isEmulated()}getCustomerSupportAgentTokenLoading(){return R(!1)}logoutCustomerSupportAgent(){return T(this,null,function*(){let t=this.authStorageService.getEmulatedUserToken(),i;this.userIdService.isEmulated().subscribe(r=>i=r).unsubscribe(),yield this.oAuthLibWrapperService.revokeAndLogout(),this.store.dispatch({type:"[Auth] Logout Customer Support Agent"}),this.authStorageService.setTokenTarget(c.User),i&&t?(this.store.dispatch(new d.Logout),this.authStorageService.setToken(t),this.userIdService.setUserId(ie),this.authStorageService.clearEmulatedUserToken(),this.store.dispatch(new d.Login)):this.authService.logout()})}static{this.\u0275fac=function(i){return new(i||e)(s(h),s(z),s(b),s(U),s(D),s(fe))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Le=(()=>{class e extends W{constructor(t,i,r,n,o,u,g,f){super(t,i,n,o,g,u,f),this.authService=t,this.authStorageService=i,this.csAgentAuthService=r,this.oAuthLibWrapperService=n,this.routingService=o,this.globalMessageService=u,this.occEndpointsService=g,this.authRedirectService=f}shouldAddAuthorizationHeader(t){return super.shouldAddAuthorizationHeader(t)||this.isCSAgentTokenRequest(t)}shouldCatchError(t){return super.shouldCatchError(t)||this.isCSAgentTokenRequest(t)}alterRequest(t,i){let r=!!this.getAuthorizationHeader(t),n=this.isCSAgentTokenRequest(t),o=super.alterRequest(t,i);return!r&&n?(o=t.clone({setHeaders:V({},this.createAuthorizationHeader(i))}),F.removeHeader(H,o)):o}isCSAgentTokenRequest(t){return!!F.getInterceptorParam(H,t.headers)}handleExpiredRefreshToken(){this.csAgentAuthService.isCustomerSupportAgentLoggedIn().pipe(w(1)).subscribe(t=>{t?(this.authService.setLogoutProgress(!0),this.csAgentAuthService.logoutCustomerSupportAgent(),this.globalMessageService.add({key:"asm.csagentTokenExpired"},$.MSG_TYPE_ERROR)):super.handleExpiredRefreshToken()})}static{this.\u0275fac=function(i){return new(i||e)(s(h),s(p),s(Ae),s(U),s(M),s(x),s(O),s(P))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Ce=(()=>{class e extends h{constructor(t,i,r,n,o,u,g,f){super(t,i,r,n,o,g,f),this.store=t,this.userIdService=i,this.oAuthLibWrapperService=r,this.authStorageService=n,this.authRedirectService=o,this.globalMessageService=u,this.routingService=g,this.authMultisiteIsolationService=f}canUserLogin(){let t,i;return this.authStorageService.getToken().subscribe(r=>i=r).unsubscribe(),this.authStorageService.getTokenTarget().subscribe(r=>t=r).unsubscribe(),!(i?.access_token&&t===c.CSAgent)}warnAboutLoggedCSAgent(){this.globalMessageService.add({key:"asm.auth.agentLoggedInError"},$.MSG_TYPE_ERROR)}loginWithCredentials(t,i){return T(this,null,function*(){this.canUserLogin()?yield Y(e.prototype,this,"loginWithCredentials").call(this,t,i):this.warnAboutLoggedCSAgent()})}loginWithRedirect(){return this.canUserLogin()?(super.loginWithRedirect(),!0):(this.warnAboutLoggedCSAgent(),!1)}coreLogout(){return X(this.userIdService.isEmulated().pipe(w(1),J(t=>t?(this.authStorageService.clearEmulatedUserToken(),this.userIdService.clearUserId(),this.store.dispatch(new d.Logout),R(!0)):B(super.coreLogout()))))}isUserLoggedIn(){return j([this.authStorageService.getToken(),this.userIdService.isEmulated(),this.authStorageService.getTokenTarget()]).pipe(E(([t,i,r])=>!!t?.access_token&&(r===c.User||r===c.CSAgent&&i)))}static{this.\u0275fac=function(i){return new(i||e)(s(D),s(b),s(U),s(z),s(P),s(x),s(M),s(ae))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Be=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=v({type:e})}static{this.\u0275inj=S({providers:[C(Re),{provide:p,useExisting:z},{provide:h,useExisting:Ce},{provide:W,useExisting:Le},{provide:A,useExisting:Ee,multi:!0}],imports:[Ie]})}}return e})(),I="asm",Xe=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:()=>l({facade:e,feature:I,methods:["bindCart"]}),providedIn:"root"})}}return e})(),Ze=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:()=>l({facade:e,feature:I,methods:["createCustomer"]}),providedIn:"root"})}}return e})(),Je=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:()=>l({facade:e,feature:I,methods:["getCustomerLists","getCustomerListsState","customerListCustomersSearch","getCustomerListCustomersSearchResults","getCustomerListCustomersSearchResultsLoading","customerListCustomersSearchReset","getCustomerListCustomersSearchResultsError"]}),providedIn:"root"})}}return e})(),Qe=(()=>{class e{constructor(t,i,r){this.routingService=t,this.winRef=i,this.asmEnablerService=r,this.searchParams=new URLSearchParams(this.winRef?.location?.search)}isEmulateInURL(){return this.asmEnablerService?.isEmulateInURL()||!1}getSearchParameter(t){return this.searchParams.get(t)??void 0}handleNavigation(t=this.getParamsInUrl()){t.cartType==="active"?this.routingService.go({cxRoute:"cart"}):t.cartType==="saved"&&t.cartId?this.routingService.go("my-account/saved-cart/"+t.cartId):t.orderId?this.routingService.go({cxRoute:"orderDetails",params:{code:t.orderId}}):t.ticketId&&this.routingService.go({cxRoute:"supportTicketDetails",params:{ticketCode:t.ticketId}})}getParamsInUrl(){let t={customerId:this.getSearchParameter("customerId"),orderId:this.getSearchParameter("orderId"),ticketId:this.getSearchParameter("ticketId"),cartId:this.getSearchParameter("cartId"),cartType:this.getSearchParameter("cartType")};return Object.fromEntries(Object.entries(t).filter(([i,r])=>!!r))}static{this.\u0275fac=function(i){return new(i||e)(s(M),s(_),s(ve))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var G="asmCustomer360",be="asmCustomer360Core",Ue=(()=>{class e{constructor(t,i,r,n){this.languageService=t,this.currencyService=i,this.occEndpoints=r,this.config=n,this.activeLang=N(this.config,oe),this.activeCurr=N(this.config,ne),this.languageService.getActive().subscribe(o=>this.activeLang=o),this.currencyService.getActive().subscribe(o=>{this.activeCurr=o})}intercept(t,i){return t.url.includes(this.occEndpoints.getBaseUrl({prefix:!1,baseSite:!1}))&&t.url.includes("/assistedservicewebservices/")&&(t=t.clone({setParams:{lang:this.activeLang??"",curr:this.activeCurr??""}})),i.handle(t)}static{this.\u0275fac=function(i){return new(i||e)(s(de),s(he),s(O),s(se))}}static{this.\u0275prov=a({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),ot=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275mod=v({type:e})}static{this.\u0275inj=S({providers:[C({featureModules:{[G]:{dependencies:[I]},[be]:G}}),{provide:A,useExisting:Ue,multi:!0}],imports:[y]})}}return e})(),nt=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=a({token:e,factory:()=>l({facade:e,feature:G,methods:["get360Data"]}),providedIn:"root"})}}return e})();var Me=function(e){return e.REVIEW_LIST="c360ReviewList",e.STORE_LOCATION="c360StoreLocation",e.PRODUCT_INTEREST_LIST="c360CustomerProductInterestList",e.SUPPORT_TICKET_LIST="c360TicketList",e.CUSTOMER_PROFILE="c360CustomerProfile",e.ACTIVE_CART="c360Cart",e.SAVED_CART="c360SavedCart",e.OVERVIEW="c360Overview",e.ACTIVITY_LIST="c360ActivityList",e.COUPON_LIST="c360CouponList",e.PROMOTION_LIST="c360PromotionList",e.CUSTOMER_COUPON_LIST="c360CustomerCouponList",e}(Me||{}),Oe=function(e){return e.VISA="visa",e.MASTER="master",e.MASTERCARD_EUROCARD="mastercard_eurocard",e.DINERS="diners",e.AMEX="amex",e}(Oe||{}),ke=function(e){return e.ARROW_LEFT="ArrowLeft",e.ARROW_RIGHT="ArrowRight",e.ARROW_DOWN="ArrowDown",e.ARROW_UP="ArrowUp",e.HOME="Home",e.END="End",e.PAGE_DOWN="PageDown",e.PAGE_UP="PageUp",e}(ke||{}),ye=function(e){return e.NAVIGATE="NAVIGATE",e}(ye||{});export{Ke as a,Se as b,ve as c,m as d,z as e,Ae as f,Be as g,I as h,Xe as i,Ze as j,Je as k,Qe as l,G as m,ot as n,nt as o,Me as p,Oe as q,ke as r,ye as s};

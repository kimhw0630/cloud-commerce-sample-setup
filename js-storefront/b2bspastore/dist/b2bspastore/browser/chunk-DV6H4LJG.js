import{a as Tt,c as Q,d as Et}from"./chunk-DPERVHM5.js";import{H as z,R as St,S as R,g as ce,h as se}from"./chunk-GKBE6IVR.js";import{$ as gt,$a as Ot,C as pt,Da as yt,E as we,Fa as Qe,La as Ct,Ma as kt,Y as mt,_ as _t,_a as vt,b as Oe,c as be,d as qe,db as bt,e as Se,ea as ft,eb as qt,g as dt,j as oe,l as Te,m as lt,p as Ee,s as Fe,va as ht,x as ut,ya as Ie,za as xt}from"./chunk-FKA4XEVN.js";import{$b as Ye,Ab as ue,Bb as pe,Bf as ke,Cb as me,Cd as ie,Cf as ne,Db as Ge,Dc as Ke,De as tt,E as Re,Ea as f,Eb as _,Eg as st,Fa as h,Fb as J,Fg as at,G as De,Gb as x,Gc as fe,Gd as xe,Hb as _e,I as D,Je as re,Md as Xe,N as Ve,Na as le,Pb as O,Q as Le,Qb as Z,R as V,Rb as We,Sa as o,Ta as b,V as Ne,Wb as c,Xb as a,Xf as nt,Yb as q,_ as L,bb as m,cb as E,ce as Je,db as s,ec as Ue,ef as it,f as I,fb as U,fc as ge,fe as Ze,gg as ot,h as Be,hb as je,hg as ct,i as w,ia as G,jb as l,kb as p,kf as $,la as W,lb as C,lf as ye,mb as k,nb as v,pb as T,qa as Y,qe as et,ra as B,rb as S,rc as He,s as M,sb as u,sg as j,ta as F,tc as ee,tg as ve,ua as de,uc as K,v as P,vb as H,w as Ae,wd as ze,wf as rt,xf as Ce,y as $e,ya as N,yd as he,za as A,zc as te}from"./chunk-ZJZHXN4F.js";var Ft=(()=>{class t{constructor(e,i,r,n){this.activeCartService=e,this.config=i,this.eventService=r,this.productSearchConnector=n,this.productAdded$=new Be,this.entries$=new w([]),this.softDeletedEntries$=new w({}),this.nonPurchasableProductError$=new w(null),this.hardDeleteTimeout=this.config.quickOrder?.list?.hardDeleteTimeout||7e3,this.quickOrderListLimit=0,this.clearDeleteTimeouts={}}ngOnDestroy(){this.clearDeletedEntries()}getEntries(){return this.entries$}searchProducts(e,i){if(this.productSearchConnector){let r={pageSize:i||Tt.quickOrder?.searchForm?.maxProducts};return this.productSearchConnector.search(e,r).pipe(P(n=>n.products||[]))}else return M([])}clearList(){this.entries$.next([])}canAdd(e,i){return e&&i?M(this.isProductOnTheList(e)||!this.isLimitExceeded(e,i)):e?M(this.isProductOnTheList(e)||!this.isLimitExceeded()):M(!this.isLimitExceeded())}setListLimit(e){this.quickOrderListLimit=e}loadEntries(e=[]){this.entries$.next(e)}updateEntryQuantity(e,i){let r=this.entries$.getValue()||[];r[e].quantity=i,this.entries$.next(r)}softDeleteEntry(e){this.entries$.pipe(V(1)).subscribe(i=>{let r=i;this.addSoftEntryDeletion(r[e],!0),r.splice(e,1),this.entries$.next(r)})}addProduct(e,i=1){let r=this.generateOrderEntry(e,i);this.addEntry(r)}getProductAdded(){return this.productAdded$}setProductAdded(e){this.productAdded$.next(e)}addToCart(){let e=[],i=[],r=this.eventService.get(ce).subscribe(n=>{(n.quantityAdded===0||n.quantityAdded&&n.quantityAdded<n.quantity)&&i.push(this.createQuickOrderResultEvent(n))});return r.add(this.eventService.get(se).subscribe(n=>{i.push(this.createQuickOrderResultEvent(n))})),this.getEntries().pipe(L(),G(n=>(e=n,this.activeCartService.addEntries(n),this.clearList(),this.activeCartService.isStable())),D(n=>n),P(()=>[e,i]),W(()=>r.unsubscribe()))}getSoftDeletedEntries(){return this.softDeletedEntries$}restoreSoftDeletedEntry(e){let i=this.getSoftDeletedEntry(e);this.addEntry(i),this.hardDeleteEntry(e)}hardDeleteEntry(e){let i=this.getSoftDeletedEntry(e),r=this.softDeletedEntries$.getValue();i&&(delete r[e],this.softDeletedEntries$.next(r)),this.clearDeleteTimeout(e)}clearDeletedEntries(){Object.values(this.clearDeleteTimeouts).forEach(e=>e.unsubscribe()),this.softDeletedEntries$.next({}),this.clearDeleteTimeouts={}}getNonPurchasableProductError(){return this.nonPurchasableProductError$}setNonPurchasableProductError(e){this.nonPurchasableProductError$.next(e)}clearNonPurchasableProductError(){this.nonPurchasableProductError$.next(null)}addSoftEntryDeletion(e,i=!0){let r=this.softDeletedEntries$.getValue(),n=e?.product?.code;if(n&&(r[n]=e,this.softDeletedEntries$.next(r),i)){let g=Re(this.hardDeleteTimeout).subscribe(()=>{this.hardDeleteEntry(n)});this.clearDeleteTimeouts[n]=g}}getSoftDeletedEntry(e){return this.softDeletedEntries$.getValue()[e]}generateOrderEntry(e,i){return{basePrice:e.price,product:e,quantity:i,totalPrice:e.price}}addEntry(e){if(e?.product?.code&&!this.isProductOnTheList(e.product.code)&&this.isLimitExceeded())return;let i=this.entries$.getValue()||[],r=e.product?.stock?.stockLevel;if(r&&e.quantity&&e.quantity>r&&(e.quantity=r),e.product?.code&&this.isProductOnTheList(e.product.code)){let n=i.findIndex(y=>y.product?.code===e.product?.code),g=i[n].quantity;if(g&&e.quantity){i[n].quantity=g+e?.quantity;let y=i[n].quantity;y&&r&&y>r&&(i[n].quantity=r),this.entries$.next([...i])}}else this.entries$.next([...i,e]);this.productAdded$.next(e.product?.code)}isProductOnTheList(e){return!!(this.entries$.getValue()||[]).find(r=>r.product?.code===e)}isLimitExceeded(e,i){let r=this.entries$.getValue()||[],n=e&&i?this.getMissingProductIndex(r,e,i):0;return r.length+(n||0)>=this.quickOrderListLimit}getMissingProductIndex(e,i,r){return(r?.filter(g=>!e.map(y=>y.product?.code).includes(g.productCode))||[]).findIndex(g=>g.productCode===i)}createQuickOrderResultEvent(e){let i={productCode:e.productCode,quantity:e.quantity};if("entry"in e&&(i.entry=e.entry),"quantityAdded"in e&&(i.quantityAdded=e.quantityAdded),"error"in e&&e.error instanceof Xe&&(i.error=e.error),i.error?.details?.length){let r=i.error?.details.some(n=>n.type==="InsufficientStockError");i.quantityAdded=r?0:i.quantity}return i}clearDeleteTimeout(e){let i=this.clearDeleteTimeouts[e];i&&(i.unsubscribe(),delete this.clearDeleteTimeouts[e])}static{this.\u0275fac=function(i){return new(i||t)(F(z),F(ie),F(re),F(at))}}static{this.\u0275prov=Y({token:t,factory:t.\u0275fac})}}return t})(),Nt=[Ft,{provide:Q,useExisting:Ft}],Me=(()=>{class t{constructor(e,i,r){this.quickOrderService=e,this.siteContextParamsService=i,this.statePersistenceService=r,this.subscription=new I,this.key="quick-order"}initSync(){this.subscription.add(this.statePersistenceService.syncWithStorage({key:this.key,state$:this.quickOrderService.getEntries(),context$:this.siteContextParamsService.getValues([et]),storageType:tt.SESSION_STORAGE,onRead:e=>this.onRead(e)}))}onRead(e){e&&this.quickOrderService.loadEntries(e)}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(F(Q),F(nt),F(it))}}static{this.\u0275prov=Y({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),It=(()=>{class t{static forRoot(){return{ngModule:t}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=A({type:t})}static{this.\u0275inj=B({providers:[...Nt,Me]})}}return t})();var Mt=t=>({label:t});function Gt(t,d){t&1&&(l(0,"abbr",10),c(1,"cxTranslate"),_(2,"*"),p()),t&2&&H("title",a(1,1,"common.required"))}function Wt(t,d){t&1&&(k(0),m(1,Gt,3,3,"abbr",9),v()),t&2&&(o(),s("cxFeature","a11yRequiredAsterisks"))}function Yt(t,d){t&1&&(k(0),C(1,"input",11),c(2,"cxTranslate"),c(3,"cxTranslate"),v()),t&2&&(o(),H("placeholder",a(2,2,"quickOrderCartForm.productCodePlaceholder")),E("aria-label",a(3,4,"quickOrderCartForm.entryProductCode")))}function Ut(t,d){t&1&&(k(0),C(1,"input",12),c(2,"cxTranslate"),c(3,"cxTranslate"),v()),t&2&&(o(),H("placeholder",a(2,2,"quickOrderCartForm.productCodePlaceholder")),E("aria-label",a(3,4,"quickOrderCartForm.entryProductCode")))}function Ht(t,d){t&1&&(k(0),C(1,"input",13),c(2,"cxTranslate"),v()),t&2&&(o(),E("aria-label",a(2,1,"quickOrderCartForm.quantity")))}function Kt(t,d){t&1&&(k(0),C(1,"input",14),c(2,"cxTranslate"),v()),t&2&&(o(),E("aria-label",a(2,1,"quickOrderCartForm.quantity")))}function zt(t,d){if(t&1&&(k(0),l(1,"button",15),c(2,"async"),c(3,"async"),c(4,"cxTranslate"),_(5),c(6,"cxTranslate"),p(),v()),t&2){let e,i=u(2);o(),U("disabled",a(2,5,i.cartIsLoading$)),s("disabled",a(3,7,i.cartIsLoading$)||!(!(i.quickOrderForm==null||(e=i.quickOrderForm.get("productCode"))==null)&&e.value)||!(!(i.quickOrderForm==null||(e=i.quickOrderForm.get("quantity"))==null)&&e.value)),E("aria-label",a(4,9,"quickOrderCartForm.addToCart")),o(4),x(" ",a(6,11,"quickOrderCartForm.add")," ")}}function Xt(t,d){if(t&1&&(C(0,"cx-form-errors",18),c(1,"cxTranslate")),t&2){let e=u(3);s("translationParams",O(4,Mt,a(1,2,"quickOrderCartForm.productCodeLabel")))("control",e.quickOrderForm.get("productCode"))}}function Jt(t,d){if(t&1&&C(0,"cx-form-errors",19),t&2){let e=u(3);s("control",e.quickOrderForm.get("productCode"))}}function Zt(t,d){if(t&1&&(C(0,"cx-form-errors",18),c(1,"cxTranslate")),t&2){let e=u(3);s("translationParams",O(4,Mt,a(1,2,"quickOrderCartForm.quantityLabel")))("control",e.quickOrderForm.get("quantity"))}}function ei(t,d){if(t&1&&C(0,"cx-form-errors",19),t&2){let e=u(3);s("control",e.quickOrderForm.get("quantity"))}}function ti(t,d){if(t&1&&(k(0),l(1,"button",15),c(2,"async"),c(3,"async"),c(4,"cxTranslate"),_(5),c(6,"cxTranslate"),p(),m(7,Xt,2,6,"cx-form-errors",16)(8,Jt,1,1,"cx-form-errors",17)(9,Zt,2,6,"cx-form-errors",16)(10,ei,1,1,"cx-form-errors",17),v()),t&2){let e=u(2);o(),U("disabled",a(2,9,e.cartIsLoading$)),s("disabled",a(3,11,e.cartIsLoading$)),E("aria-label",a(4,13,"quickOrderCartForm.addToCart")),o(4),x(" ",a(6,15,"quickOrderCartForm.add")," "),o(2),s("cxFeature","formErrorsDescriptiveMessages"),o(),s("cxFeature","!formErrorsDescriptiveMessages"),o(),s("cxFeature","formErrorsDescriptiveMessages"),o(),s("cxFeature","!formErrorsDescriptiveMessages")}}function ii(t,d){if(t&1){let e=T();k(0),l(1,"div",1),_(2),c(3,"cxTranslate"),p(),l(4,"div",2)(5,"form",3),S("ngSubmit",function(){f(e);let r=u();return h(r.applyQuickOrder())}),l(6,"div",4)(7,"span",5)(8,"label",6),_(9),c(10,"cxTranslate"),m(11,Wt,2,1,"ng-container",7),p(),m(12,Yt,4,6,"ng-container",7)(13,Ut,4,6,"ng-container",7),p(),l(14,"span",8)(15,"label",6),_(16),c(17,"cxTranslate"),p(),m(18,Ht,3,3,"ng-container",7)(19,Kt,3,3,"ng-container",7),p(),m(20,zt,7,13,"ng-container",7)(21,ti,11,17,"ng-container",7),p()()(),v()}if(t&2){let e=u();o(2),x(" ",a(3,11,"quickOrderCartForm.title")," "),o(3),s("formGroup",e.quickOrderForm),o(4),x(" ",a(10,13,"quickOrderCartForm.productCodeLabel")," "),o(2),s("cxFeature","!a11yDisabledCouponAndQuickOrderActionButtonsInsteadOfRequiredFields"),o(),s("cxFeature","a11yDisabledCouponAndQuickOrderActionButtonsInsteadOfRequiredFields"),o(),s("cxFeature","!a11yDisabledCouponAndQuickOrderActionButtonsInsteadOfRequiredFields"),o(3),x(" ",a(17,15,"quickOrderCartForm.quantityLabel")," "),o(2),s("cxFeature","a11yDisabledCouponAndQuickOrderActionButtonsInsteadOfRequiredFields"),o(),s("cxFeature","!a11yDisabledCouponAndQuickOrderActionButtonsInsteadOfRequiredFields"),o(),s("cxFeature","a11yDisabledCouponAndQuickOrderActionButtonsInsteadOfRequiredFields"),o(),s("cxFeature","!a11yDisabledCouponAndQuickOrderActionButtonsInsteadOfRequiredFields")}}var ri=["quickOrderInput"],Pt=t=>({limit:t}),X=t=>({count:t}),Bt=t=>({id:t});function ni(t,d){if(t&1){let e=T();l(0,"button",10),c(1,"cxTranslate"),c(2,"cxTranslate"),S("click",function(r){f(e);let n=u();return h(n.clear(r))})("keydown.enter",function(r){f(e);let n=u();return h(n.clear(r))}),C(3,"cx-icon",11),p()}if(t&2){let e=u();E("aria-label",a(1,3,"common.reset"))("title",a(2,5,"common.reset")),o(3),s("type",e.iconTypes.RESET)}}function oi(t,d){if(t&1&&(l(0,"button",12),c(1,"cxTranslate"),C(2,"cx-icon",11),p()),t&2){let e=u();E("aria-label",a(1,2,"common.search")),o(2),s("type",e.iconTypes.SEARCH)}}function ci(t,d){t&1&&(l(0,"span",13),_(1),c(2,"cxTranslate"),p()),t&2&&(o(),x(" ",a(2,1,"quickOrderForm.listLimitReached")," "))}function si(t,d){if(t&1&&C(0,"cx-media",25),t&2){let e=u().$implicit;s("alt",e.name)("container",e.images==null?null:e.images.PRIMARY)}}function ai(t,d){if(t&1){let e=T();l(0,"li",19)(1,"button",20),S("blur",function(r){f(e);let n=u(3);return h(n.onBlur(r))})("mousedown",function(r){let n=f(e).$implicit,g=u(3);return h(g.add(n,r))})("keydown.arrowdown",function(r){f(e);let n=u(3);return h(n.focusNextChild(r))})("keydown.arrowup",function(r){f(e);let n=u(3);return h(n.focusPreviousChild(r))})("keydown.enter",function(r){let n=f(e).$implicit,g=u(3);return h(g.add(n,r))})("keydown.escape",function(r){f(e);let n=u(3);return h(n.clear(r))}),m(2,si,1,2,"cx-media",21),C(3,"div",22),l(4,"span",23),_(5),c(6,"cxTranslate"),p(),l(7,"span",24),_(8),p()()()}if(t&2){let e=d.$implicit,i=u(3);o(),U("has-media",i.config==null||i.config.quickOrder==null||i.config.quickOrder.searchForm==null?null:i.config.quickOrder.searchForm.displayProductImages),o(),s("ngIf",i.config==null||i.config.quickOrder==null||i.config.quickOrder.searchForm==null?null:i.config.quickOrder.searchForm.displayProductImages),o(),s("innerHTML",e.name,le),o(2),x(" ",q(6,6,"quickOrderForm.id",O(9,Bt,e.code))," "),o(3),J(e.price==null?null:e.price.formattedValue)}}function di(t,d){if(t&1&&(l(0,"ul",17),m(1,ai,9,11,"li",18),p()),t&2){let e=u(2);o(),s("ngForOf",e.results)}}function li(t,d){t&1&&(l(0,"span",26),_(1),c(2,"cxTranslate"),p()),t&2&&(o(),x(" ",a(2,1,"quickOrderForm.noResults")," "))}function ui(t,d){if(t&1&&(l(0,"div",14),m(1,di,2,1,"ul",15)(2,li,3,3,"span",16),p()),t&2){let e=u();o(),s("ngIf",e.isResultsBoxOpen()&&e.results.length),o(),s("ngIf",e.noResults)}}function pi(t,d){if(t&1&&C(0,"cx-media",25),t&2){let e=u().$implicit;s("alt",e.name)("container",e.images==null?null:e.images.PRIMARY)}}function mi(t,d){if(t&1){let e=T();l(0,"li",19)(1,"button",20),S("blur",function(r){f(e);let n=u(4);return h(n.onBlur(r))})("mousedown",function(r){let n=f(e).$implicit,g=u(4);return h(g.add(n,r))})("keydown.arrowdown",function(r){f(e);let n=u(4);return h(n.focusNextChild(r))})("keydown.arrowup",function(r){f(e);let n=u(4);return h(n.focusPreviousChild(r))})("keydown.enter",function(r){let n=f(e).$implicit,g=u(4);return h(g.add(n,r))})("keydown.escape",function(r){f(e);let n=u(4);return h(n.clear(r))}),m(2,pi,1,2,"cx-media",21),C(3,"div",22),l(4,"span",23),_(5),c(6,"cxTranslate"),p(),l(7,"span",24),_(8),p()()()}if(t&2){let e=d.$implicit,i=u(4);o(),U("has-media",i.config==null||i.config.quickOrder==null||i.config.quickOrder.searchForm==null?null:i.config.quickOrder.searchForm.displayProductImages),o(),s("ngIf",i.config==null||i.config.quickOrder==null||i.config.quickOrder.searchForm==null?null:i.config.quickOrder.searchForm.displayProductImages),o(),s("innerHTML",e.name,le),o(2),x(" ",q(6,6,"quickOrderForm.id",O(9,Bt,e.code))," "),o(3),J(e.price==null?null:e.price.formattedValue)}}function _i(t,d){if(t&1&&(l(0,"ul",17),m(1,mi,9,11,"li",18),p()),t&2){let e=u(3);o(),s("ngForOf",e.results)}}function gi(t,d){t&1&&(l(0,"span",26),_(1),c(2,"cxTranslate"),p()),t&2&&(o(),x(" ",a(2,1,"quickOrderForm.noResults")," "))}function fi(t,d){if(t&1&&(l(0,"div",28),m(1,_i,2,1,"ul",15)(2,gi,3,3,"span",16),p()),t&2){let e=u(2);o(),s("ngIf",e.results.length),o(),s("ngIf",e.noResults)}}function hi(t,d){if(t&1&&(k(0),m(1,fi,3,2,"div",27),v()),t&2){let e=u();o(),s("ngIf",e.isResultsBoxOpen())}}var xi=["cx-quick-order-item",""],yi=(t,d)=>({disabled:t,"img-missing":d}),Qt=t=>({cxRoute:"product",params:t}),Ci=t=>({disabled:t});function ki(t,d){if(t&1&&C(0,"tr",10),t&2){let e=d.$implicit,i=d.index,r=u(2);s("entry",e)("index",i)("loading",r.loading)}}function vi(t,d){if(t&1&&(l(0,"table",1)(1,"caption",2),_(2),c(3,"cxTranslate"),p(),l(4,"thead")(5,"tr",3)(6,"th",4),_(7),c(8,"cxTranslate"),p(),l(9,"th",5),_(10),c(11,"cxTranslate"),p(),l(12,"th",6),_(13),c(14,"cxTranslate"),p(),l(15,"th",7),_(16),c(17,"cxTranslate"),p()()(),l(18,"tbody",8),m(19,ki,1,3,"tr",9),p()()),t&2){let e=u();o(2),x(" ",a(3,6,"quickOrderTable.caption")," "),o(5),x(" ",a(8,8,"quickOrderTable.product")," "),o(3),x(" ",a(11,10,"quickOrderTable.price")," "),o(3),x(" ",a(14,12,"quickOrderTable.quantity")," "),o(3),x(" ",a(17,14,"quickOrderTable.actions")," "),o(3),s("ngForOf",e.entries)}}var Oi=["quickOrderForm"],Pe=t=>({name:t}),At=(t,d)=>({name:t,code:d}),bi=(t,d,e)=>({name:t,code:d,quantityAdded:e});function qi(t,d){if(t&1&&(k(0),C(1,"cx-message",3),c(2,"cxTranslate"),v()),t&2){let e=u(2).ngIf,i=u();o(),s("text",q(2,3,"quickOrderList.errors.listIsFull",O(6,X,e.length)))("isVisibleCloseButton",!1)("type",i.globalMessageType.MSG_TYPE_ERROR)}}function Si(t,d){if(t&1&&(k(0),m(1,qi,3,8,"ng-container",2),v()),t&2){let e,i=u(2);o(),s("ngIf",i.quickOrderForm==null||i.quickOrderForm.form==null||(e=i.quickOrderForm.form.get("product"))==null?null:e.dirty)}}function Ti(t,d){if(t&1&&(k(0),m(1,Si,2,1,"ng-container",2),c(2,"async"),v()),t&2){let e=u();o(),s("ngIf",!a(2,1,e.canAddProduct()))}}function Ei(t,d){if(t&1){let e=T();k(0),l(1,"cx-message",4),c(2,"cxTranslate"),S("closeMessage",function(){f(e);let r=u();return h(r.clearAddToCartInformation())}),p(),v()}if(t&2){let e=u();o(),s("text",a(2,2,"quickOrderList.informations.addProductBeforeAddingToCart"))("type",e.globalMessageType.MSG_TYPE_ERROR)}}function Fi(t,d){if(t&1){let e=T();k(0),l(1,"cx-message",5),c(2,"cxTranslate"),S("closeMessage",function(){f(e);let r=u();return h(r.clearNonPurchasableError())}),p(),v()}if(t&2){let e=d.ngIf,i=u();o(),s("text",q(2,2,"quickOrderList.errors.nonPurchasableError",O(5,Pe,e.name)))("type",i.globalMessageType.MSG_TYPE_ERROR)}}function wi(t,d){if(t&1){let e=T();l(0,"cx-message",7),c(1,"cxTranslate"),c(2,"cxTranslate"),c(3,"cxTranslate"),S("buttonAction",function(){let r=f(e).$implicit,n=u(2);return h(n.undoDeletion(r.value))})("closeMessage",function(){let r=f(e).$implicit,n=u(2);return h(n.clearDeletion(r.value))}),p()}if(t&2){let e=d.$implicit,i=u(2);s("actionButtonText",a(1,4,"quickOrderList.undo"))("actionButtonMessage",q(2,6,"quickOrderList.revokeUndo",O(12,Pe,e.value.product==null?null:e.value.product.name)))("text",q(3,9,"quickOrderList.productWasDeleted",O(14,Pe,e.value.product==null?null:e.value.product.name)))("type",i.globalMessageType.MSG_TYPE_CONFIRMATION)}}function Ii(t,d){if(t&1&&(k(0),m(1,wi,4,16,"cx-message",6),c(2,"keyvalue"),v()),t&2){let e=d.ngIf;o(),s("ngForOf",a(2,1,e))}}function Qi(t,d){if(t&1&&(l(0,"li",13)(1,"span"),_(2),c(3,"cxTranslate"),p()()),t&2){let e=d.$implicit;o(2),x(" ",q(3,1,"quickOrderList.errors.productIsOutOfStock",Z(4,At,e.entry.product.name,e.entry.product.code))," ")}}function Mi(t,d){if(t&1){let e=T();l(0,"cx-message",9),c(1,"cxTranslate"),c(2,"cxTranslate"),S("closeMessage",function(){f(e);let r=u(2);return h(r.clearErrors())}),l(3,"ul",10),m(4,Qi,4,7,"li",11),p(),l(5,"div",12),_(6),c(7,"cxTranslate"),p()()}if(t&2){let e=u().ngIf,i=u();s("accordionText",a(1,5,"quickOrderList.errors.reviewErrors"))("text",a(2,7,"quickOrderList.errorProceedingToCart"))("type",i.globalMessageType.MSG_TYPE_ERROR),o(4),s("ngForOf",e),o(2),x(" ",q(7,9,"quickOrderList.errors.outOfStockErrorFound",O(12,X,e.length))," ")}}function Pi(t,d){if(t&1&&(k(0),m(1,Mi,8,14,"cx-message",8),v()),t&2){let e=d.ngIf;o(),s("ngIf",e.length)}}function Bi(t,d){if(t&1&&(l(0,"li",18)(1,"span"),_(2),c(3,"cxTranslate"),p()()),t&2){let e=d.$implicit;o(2),x(" ",q(3,1,"quickOrderList.warnings.productWasReduced",We(4,bi,e.entry.product.name,e.entry.product.code,e.quantityAdded))," ")}}function Ai(t,d){if(t&1){let e=T();l(0,"cx-message",15),c(1,"cxTranslate"),c(2,"cxTranslate"),S("closeMessage",function(){f(e);let r=u(2);return h(r.clearWarnings())}),l(3,"ul",16),m(4,Bi,4,8,"li",17),p(),l(5,"div",12),_(6),c(7,"cxTranslate"),p()()}if(t&2){let e=u().ngIf,i=u();s("accordionText",a(1,5,"quickOrderList.warnings.reviewWarnings"))("text",a(2,7,"quickOrderList.warningProceedingToCart"))("type",i.globalMessageType.MSG_TYPE_WARNING),o(4),s("ngForOf",e),o(2),x(" ",q(7,9,"quickOrderList.warnings.reduceWarningFound",O(12,X,e.length))," ")}}function $i(t,d){if(t&1&&(k(0),m(1,Ai,8,14,"cx-message",14),v()),t&2){let e=d.ngIf;o(),s("ngIf",e.length)}}function Ri(t,d){if(t&1&&(l(0,"li",23)(1,"span"),_(2),c(3,"cxTranslate"),p()()),t&2){let e=d.$implicit;o(2),J(q(3,1,"quickOrderList.successes.productAddedToCart",Z(4,At,e.product.name,e.product.code)))}}function Di(t,d){if(t&1){let e=T();l(0,"cx-message",20),c(1,"cxTranslate"),S("closeMessage",function(){f(e);let r=u(2);return h(r.clearSuccesses())}),l(2,"ul",21),m(3,Ri,4,7,"li",22),p(),l(4,"div",12),_(5),c(6,"cxTranslate"),p()()}if(t&2){let e=u().ngIf,i=u();s("text",a(1,4,"quickOrderList.successfullyAddedToCart"))("type",i.globalMessageType.MSG_TYPE_CONFIRMATION),o(3),s("ngForOf",e),o(2),x(" ",q(6,6,"quickOrderList.successes.addedToCartFound",O(9,X,e.length))," ")}}function Vi(t,d){if(t&1&&(k(0),m(1,Di,7,11,"cx-message",19),v()),t&2){let e=d.ngIf;o(),s("ngIf",e.length)}}function Li(t,d){if(t&1){let e=T();l(0,"button",33),c(1,"async"),c(2,"cxTranslate"),S("click",function(){f(e);let r=u(3);return h(r.clear())}),_(3),c(4,"cxTranslate"),p()}if(t&2){let e=u(3);s("disabled",!a(1,3,e.isCartStable$)),E("aria-label",a(2,5,"quickOrderList.emptyList")),o(3),x(" ",a(4,7,"quickOrderList.emptyList")," ")}}function Ni(t,d){if(t&1){let e=T();k(0),l(1,"div",24)(2,"h2"),_(3),c(4,"cxTranslate"),p(),l(5,"p"),_(6),c(7,"cxTranslate"),p()(),l(8,"div",25),C(9,"cx-quick-order-form",26,0),p(),l(11,"div",27),C(12,"cx-quick-order-table",28),c(13,"async"),p(),l(14,"div",29)(15,"div",30),m(16,Li,5,9,"button",31),p(),l(17,"div",30)(18,"cx-progress-button",32),c(19,"cxTranslate"),c(20,"async"),S("clickEvent",function(){let r=f(e).ngIf,n=u(2);return h(n.addToCart(r))}),_(21),c(22,"cxTranslate"),p()()(),v()}if(t&2){let e=d.ngIf,i=u().ngIf,r=u();o(3),x(" ",a(4,11,"quickOrderList.header")," "),o(3),x(" ",q(7,13,"quickOrderList.subHeader",O(24,Pt,i))," "),o(3),s("limit",i),o(3),s("entries",e)("loading",!a(13,16,r.isCartStable$)),o(4),s("ngIf",e.length),o(2),je("btn-block add-button"),s("ariaLabel",a(19,18,"quickOrderList.addToCart"))("loading",!a(20,20,r.isCartStable$)),o(3),x(" ",a(22,22,"quickOrderList.addToCart")," ")}}function ji(t,d){if(t&1&&(k(0),m(1,Ni,23,26,"ng-container",2),c(2,"async"),v()),t&2){let e=u();o(),s("ngIf",a(2,1,e.entries$))}}var Gi=(()=>{class t{constructor(e,i,r,n){this.activeCartService=e,this.eventService=i,this.formBuilder=r,this.globalMessageService=n,this.featureConfig=de(rt),this.cartIsLoading$=this.activeCartService.isStable().pipe(P(g=>!g)),this.cart$=this.activeCartService.getActive(),this.min=1,this.subscription=new I,this.cartEventsSubscription=new I,this.minQuantityValue=1}ngOnInit(){this.buildForm(),this.watchQuantityChange()}ngOnDestroy(){this.subscription?.unsubscribe(),this.cartEventsSubscription?.unsubscribe()}applyQuickOrder(){if(this.quickOrderForm.invalid){this.quickOrderForm.markAllAsTouched();return}let e=this.quickOrderForm.get("productCode")?.value,i=this.quickOrderForm.get("quantity")?.value;this.watchAddEntrySuccessEvent(),this.featureConfig.isEnabled("cartQuickOrderRemoveListeningToFailEvent")||this.watchAddEntryFailEvent(),e&&i&&this.activeCartService.addEntry(e,i)}buildForm(){let e=!this.featureConfig.isEnabled("a11yDisabledCouponAndQuickOrderActionButtonsInsteadOfRequiredFields");this.quickOrderForm=this.formBuilder.group({productCode:["",e?[be.required]:[]],quantity:[this.minQuantityValue,{updateOn:"blur",validators:e?[be.required]:[]}]})}watchQuantityChange(){this.subscription.add(this.quickOrderForm.get("quantity")?.valueChanges.subscribe(e=>this.quickOrderForm.get("quantity")?.setValue(this.getValidCount(e),{emitEvent:!1})))}watchAddEntrySuccessEvent(){this.cartEventsSubscription.add(this.eventService.get(ce).pipe(L()).subscribe(e=>{let i="quickOrderCartForm.stockLevelReached",r,n=$.MSG_TYPE_WARNING;e.quantityAdded&&(i=e.quantityAdded>1?"quickOrderCartForm.entriesWereAdded":"quickOrderCartForm.entryWasAdded",r=e.quantityAdded>1?"quickOrderCartForm.products":"quickOrderCartForm.product",n=$.MSG_TYPE_CONFIRMATION),this.globalMessageService.add({key:i,params:{product:e?.entry?.product?.name||r,quantity:e.quantityAdded}},n),this.resetForm()}))}watchAddEntryFailEvent(){this.cartEventsSubscription.add(this.eventService.get(se).pipe(L()).subscribe(()=>{this.globalMessageService.add({key:"quickOrderCartForm.noResults"},$.MSG_TYPE_ERROR)}))}getValidCount(e){return(e<this.min||!e)&&(e=this.min),e}resetForm(){this.quickOrderForm.reset()}static{this.\u0275fac=function(i){return new(i||t)(b(z),b(re),b(pt),b(ye))}}static{this.\u0275cmp=N({type:t,selectors:[["cx-cart-quick-order-form"]],decls:2,vars:3,consts:[[4,"ngIf"],[1,"cx-cart-quick-order-form-title"],[1,"form-group"],[3,"ngSubmit","formGroup"],[1,"cx-cart-quick-order-form-container"],[1,"cx-cart-quick-order-form-productID"],[1,"cx-cart-quick-order-form-label"],[4,"cxFeature"],[1,"cx-cart-quick-order-form-qty"],["aria-hidden","true","class","text-decoration-none",3,"title",4,"cxFeature"],["aria-hidden","true",1,"text-decoration-none",3,"title"],["formControlName","productCode","type","text",1,"form-control","input-product-code",3,"placeholder"],["aria-required","true","formControlName","productCode","required","true","type","text",1,"form-control","input-product-code",3,"placeholder"],["formControlName","quantity","type","number",1,"form-control","input-quantity"],["aria-required","true","formControlName","quantity","required","true","type","number",1,"form-control","input-quantity"],["type","submit",1,"btn","btn-block","btn-secondary","apply-quick-order-button",3,"disabled"],[3,"translationParams","control",4,"cxFeature"],[3,"control",4,"cxFeature"],[3,"translationParams","control"],[3,"control"]],template:function(i,r){i&1&&(m(0,ii,22,17,"ng-container",0),c(1,"async")),i&2&&s("ngIf",a(1,1,r.cart$))},dependencies:[K,Te,Oe,lt,qe,Se,ut,Ee,Fe,yt,Ce,te,j],encapsulation:2,changeDetection:0})}}return t})(),Wi=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=A({type:t})}static{this.\u0275inj=B({providers:[xe({cmsComponents:{CartQuickOrderFormComponent:{component:Gi}}})],imports:[fe,we,ve,Qe,ke]})}}return t})(),Yi=(()=>{class t{constructor(e,i){this.quickOrderService=e,this.productConnector=i,this.type=St.QUICK_ORDER,this.logger=de(Ze)}getEntries(){return this.quickOrderService.getEntries()}addEntries(e){return De(e.map(i=>this.quickOrderService.canAdd(i.productCode,e).pipe(G(r=>r?this.productConnector.get(i.productCode).pipe(D(n=>!!n),W(n=>{this.quickOrderService.addProduct(n,i.quantity)}),P(n=>this.handleResults(n,i)),Ve(n=>M(this.handleErrors(n,i.productCode)))):M({productCode:i.productCode,statusCode:R.LIMIT_EXCEEDED}))))).pipe($e(),V(e.length))}handleResults(e,i){return e.stock?.stockLevel&&i.quantity>e.stock.stockLevel?{productCode:i.productCode,productName:e?.name,statusCode:R.LOW_STOCK,quantity:i.quantity,quantityAdded:e.stock.stockLevel}:e.stock?.stockLevelStatus==="outOfStock"?{productCode:i.productCode,statusCode:R.NO_STOCK,productName:e?.name}:{productCode:i.productCode,statusCode:R.SUCCESS}}handleErrors(e,i){return e?.error?.errors[0].type==="UnknownIdentifierError"?{productCode:i,statusCode:R.UNKNOWN_IDENTIFIER}:(Ue()&&this.logger.warn("Unrecognized cart add entry action type while mapping messages",e),{productCode:i,statusCode:R.UNKNOWN_ERROR})}static{this.\u0275fac=function(i){return new(i||t)(F(Q),F(st))}}static{this.\u0275prov=Y({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),ae="quick-order-searchbox-is-active",Ui=(()=>{class t{constructor(e,i,r,n){this.config=e,this.cd=i,this.quickOrderService=r,this.winRef=n,this.iconTypes=mt,this.isSearching=!1,this.noResults=!1,this.results=[],this.subscription=new I,this.searchSubscription=new I,ne("a11yTruncatedTextForResponsiveView"),ne("a11yPreventSRFocusOnHiddenElements")}ngOnInit(){this.buildForm(),this.subscription.add(this.watchProductAdd()),this.subscription.add(this.watchQueryChange())}onBlur(e){setTimeout(()=>{this.isSuggestionFocused()||this.blurSuggestionBox(e)})}clear(e){e?.preventDefault(),this.isResultsBoxOpen()&&this.toggleBodyClass(ae,!1),this.form.get("product")?.value&&this.form.reset(),this.close(),this.cd?.detectChanges()}add(e,i){if(i?.preventDefault(),e.multidimensional){this.quickOrderService.setNonPurchasableProductError(e),this.clear();return}else this.quickOrderService.clearNonPurchasableProductError();this.quickOrderService.addProduct(e),this.quickOrderInput.nativeElement.focus()}addProduct(e){this.quickOrderService.canAdd().pipe(V(1)).subscribe(i=>{if(i){if(this.results.length===1)this.add(this.results[0],e);else if(this.getFocusedIndex()!==-1){let r=this.results[this.getFocusedIndex()];this.add(r,e)}}})}focusNextChild(e){if(e.preventDefault(),!this.results.length)return;let[i,r]=[this.getResultElements(),this.getFocusedIndex()];i.length&&(r>=i.length-1?i[0].focus():i[r+1].focus())}focusPreviousChild(e){if(e.preventDefault(),!this.results.length)return;let[i,r]=[this.getResultElements(),this.getFocusedIndex()];i.length&&(r<1?i[i.length-1].focus():i[r-1].focus())}isResultsBoxOpen(){return this.winRef?!!this.winRef.document.querySelector(`.${ae}`):!1}canAddProduct(){return this.quickOrderService.canAdd()}open(){this.toggleBodyClass(ae,!0)}getResultElements(){return this.winRef?Array.from(this.winRef.document.querySelectorAll(".quick-order-results-products > li button")):[]}blurSuggestionBox(e){this.toggleBodyClass(ae,!1),e&&e.target&&e.target.blur()}getFocusedElement(){if(this.winRef)return this.winRef.document.activeElement}getFocusedIndex(){return this.getResultElements().indexOf(this.getFocusedElement())}isSuggestionFocused(){return this.getResultElements().includes(this.getFocusedElement())}toggleBodyClass(e,i){this.winRef&&(i===void 0?this.winRef.document.body.classList.toggle(e):i?this.winRef.document.body.classList.add(e):this.winRef.document.body.classList.remove(e))}buildForm(){let e=new dt({});e.setControl("product",new oe(null)),this.form=e}isEmpty(e){return e?.trim()===""||e==null}watchQueryChange(){return this.form.valueChanges.pipe(Ne(),Le(300),D(e=>this.config?.quickOrder?.searchForm?this.isEmpty(e.product)?(this.clear(),!1):!!e.product&&e.product.length>=this.config.quickOrder?.searchForm?.minCharactersBeforeRequest:e)).subscribe(e=>{this.searchProducts(e.product)})}searchProducts(e){this.searchSubscription.add(this.canAddProduct().pipe(D(Boolean),G(()=>this.quickOrderService.searchProducts(e,this.config?.quickOrder?.searchForm?.maxProducts).pipe(V(1)))).subscribe(i=>{this.results=i,this.results.length?(this.noResults=!1,this.open()):this.noResults=!0,this.cd?.detectChanges()}))}clearResults(){this.results=[]}close(){this.resetSearchSubscription(),this.clearResults(),this.noResults=!1}resetSearchSubscription(){this.searchSubscription.unsubscribe(),this.searchSubscription=new I}watchProductAdd(){return this.quickOrderService.getProductAdded().subscribe(()=>this.clear())}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(b(ie),b(ge),b(Q),b(Je))}}static{this.\u0275cmp=N({type:t,selectors:[["cx-quick-order-form"]],viewQuery:function(i,r){if(i&1&&ue(ri,5),i&2){let n;pe(n=me())&&(r.quickOrderInput=n.first)}},inputs:{limit:"limit"},decls:18,vars:30,consts:[["quickOrderInput",""],["searchIcon",""],[1,"quick-order-form-container",3,"formGroup"],["role","combobox","aria-controls","quick-order-search-results",1,"quick-order-form-input"],["aria-controls","quick-order-search-results","aria-describedby","quickOrderFormInitialDescription","formControlName","product","type","text",1,"form-control",3,"blur","focus","keydown.arrowdown","keydown.arrowup","keydown.enter","keydown.escape","placeholder"],["class","quick-order-form-reset-icon",3,"click","keydown.enter",4,"ngIf","ngIfElse"],["class","list-limit-reached-text","role","alert",4,"ngIf"],["id","quick-order-search-results","class","quick-order-results",4,"cxFeature"],[4,"cxFeature"],["aria-live","polite","id","quickOrderFormInitialDescription","aria-atomic","true",1,"cx-visually-hidden","quick-order-form-description"],[1,"quick-order-form-reset-icon",3,"click","keydown.enter"],[3,"type"],["tabindex","-1",1,"quick-order-form-search-icon"],["role","alert",1,"list-limit-reached-text"],["id","quick-order-search-results",1,"quick-order-results"],["class","quick-order-results-products","role","listbox",4,"ngIf"],["class","quick-order-no-results",4,"ngIf"],["role","listbox",1,"quick-order-results-products"],["class","quick-order-results-product-container",4,"ngFor","ngForOf"],[1,"quick-order-results-product-container"],["role","option",1,"quick-order-results-product",3,"blur","mousedown","keydown.arrowdown","keydown.arrowup","keydown.enter","keydown.escape"],["class","media","format","thumbnail","role","presentation",3,"alt","container",4,"ngIf"],[1,"name",3,"innerHTML"],[1,"id"],[1,"price"],["format","thumbnail","role","presentation",1,"media",3,"alt","container"],[1,"quick-order-no-results"],["class","quick-order-results","role","dialog","id","quick-order-search-results",4,"ngIf"],["role","dialog","id","quick-order-search-results",1,"quick-order-results"]],template:function(i,r){if(i&1){let n=T();l(0,"form",2)(1,"div",3),c(2,"cxTranslate"),l(3,"input",4,0),c(5,"cxTranslate"),c(6,"cxTranslate"),S("blur",function(y){return f(n),h(r.onBlur(y))})("focus",function(){return f(n),h(r.open())})("keydown.arrowdown",function(y){return f(n),h(r.focusNextChild(y))})("keydown.arrowup",function(y){return f(n),h(r.focusPreviousChild(y))})("keydown.enter",function(y){return f(n),h(r.addProduct(y))})("keydown.escape",function(y){return f(n),h(r.clear(y))}),p(),m(7,ni,4,7,"button",5)(8,oi,3,4,"ng-template",null,1,Ye)(10,ci,3,3,"span",6),c(11,"async"),p(),m(12,ui,3,2,"div",7)(13,hi,2,1,"ng-container",8),p(),l(14,"label",9),_(15),c(16,"cxTranslate"),c(17,"cxTranslate"),p()}if(i&2){let n,g,y=Ge(9);s("formGroup",r.form),o(),E("aria-expanded",r.isResultsBoxOpen())("aria-label",a(2,12,"quickOrderForm.quickOrderSearch")),o(2),H("placeholder",a(5,14,"quickOrderForm.placeholder")),E("aria-label",q(6,16,"quickOrderForm.searchBoxLabel",O(26,Pt,r.limit))),o(4),s("ngIf",(n=r.form.get("product"))==null?null:n.value)("ngIfElse",y),o(3),s("ngIf",!a(11,19,r.canAddProduct())&&((g=r.form.get("product"))==null?null:g.dirty)),o(2),s("cxFeature","a11yQuickOrderAriaControls"),o(),s("cxFeature","!a11yQuickOrderAriaControls"),o(2),_e(" ",r.results.length?q(16,21,"quickOrderForm.productsResults",O(28,X,r.results.length)):""," ",a(17,24,"quickOrderForm.initialDescription"),`
`)}},dependencies:[ee,K,_t,Ie,Te,Oe,qe,Se,Ee,Fe,Ce,te,j],encapsulation:2,changeDetection:0})}}return t})(),Hi=(()=>{class t{get entry(){return this._entry}set entry(e){this._entry=e,this.quantityControl=new oe(this.entry.quantity,{updateOn:"blur"})}constructor(e,i){this.cd=e,this.quickOrderService=i,this.loading=!1,this.subscription=new I,ne("a11yCartItemsLinksStyles")}ngOnInit(){this.subscription.add(this.quantityControl.valueChanges.subscribe(()=>{this.quickOrderService.updateEntryQuantity(this.index,this.quantityControl.value)})),this.subscription.add(this.watchProductAdd())}removeEntry(){this.quickOrderService.softDeleteEntry(this.index),this.cd.detectChanges()}watchProductAdd(){return this.quickOrderService.getProductAdded().subscribe(e=>{e===this.entry.product?.code&&(this.quantityControl=new oe(this.entry.quantity),this.cd.detectChanges())})}ngOnDestroy(){this.subscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||t)(b(ge),b(Q))}}static{this.\u0275cmp=N({type:t,selectors:[["","cx-quick-order-item",""],["cx-quick-order-item"]],inputs:{entry:"entry",index:"index",loading:"loading"},attrs:xi,decls:30,vars:41,consts:[["role","cell"],[1,"cx-table-item-container"],["tabindex","-1",3,"ngClass","routerLink"],["format","cartIcon",3,"container","alt"],[1,"cx-info"],[1,"cx-name"],[1,"cx-link",3,"ngClass","routerLink"],[1,"cx-code"],["role","cell",1,"cx-price"],[1,"cx-mobile-header"],[1,"cx-value"],["role","cell",1,"cx-quantity"],[3,"control","max","readonly"],["role","cell",1,"cx-actions"],[1,"btn","btn-tertiary",3,"click","disabled"]],template:function(i,r){i&1&&(l(0,"td",0)(1,"div",1)(2,"a",2),c(3,"cxUrl"),C(4,"cx-media",3),p(),l(5,"div",4)(6,"div",5)(7,"a",6),c(8,"cxUrl"),_(9),p()(),l(10,"div",7),_(11),c(12,"cxTranslate"),p()()()(),l(13,"td",8)(14,"div",9),_(15),c(16,"cxTranslate"),p(),l(17,"div",10),_(18),p()(),l(19,"td",11)(20,"div",9),_(21),c(22,"cxTranslate"),p(),l(23,"div",10),C(24,"cx-item-counter",12),p()(),l(25,"td",13)(26,"button",14),c(27,"cxTranslate"),S("click",function(){return r.removeEntry()}),_(28),c(29,"cxTranslate"),p()()),i&2&&(o(2),s("ngClass",Z(32,yi,r.loading,!(!(r.entry==null||r.entry.product==null||r.entry.product.images==null)&&r.entry.product.images.PRIMARY)))("routerLink",a(3,18,O(35,Qt,r.entry.product))),o(2),s("container",r.entry==null||r.entry.product==null||r.entry.product.images==null?null:r.entry.product.images.PRIMARY)("alt",r.entry==null||r.entry.product==null?null:r.entry.product.name),o(3),s("ngClass",O(37,Ci,r.loading))("routerLink",a(8,20,O(39,Qt,r.entry.product))),o(2),x("",(r.entry.product==null?null:r.entry.product.name)||"-"," "),o(2),_e(" ",a(12,22,"quickOrderTable.id")," ",r.entry.product==null?null:r.entry.product.code," "),o(4),x(" ",a(16,24,"quickOrderTable.itemPrice")," "),o(3),x(" ",(r.entry.basePrice==null?null:r.entry.basePrice.formattedValue)||"-"," "),o(3),x(" ",a(22,26,"quickOrderTable.qty")," "),o(3),s("control",r.quantityControl)("max",r.entry.product==null||r.entry.product.stock==null?null:r.entry.product.stock.stockLevel)("readonly",r.loading),o(2),s("disabled",r.loading),E("aria-label",a(27,28,"common.remove")),o(2),x(" ",a(29,30,"common.remove")," "))},dependencies:[He,Ct,Ie,ze,j,ot],encapsulation:2,changeDetection:0})}}return t})(),Ki=(()=>{class t{constructor(){this.entries=[],this.loading=!1}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=N({type:t,selectors:[["cx-quick-order-table"]],inputs:{entries:"entries",loading:"loading"},decls:1,vars:1,consts:[["class","cx-quick-order-table-wrapper","role","table",4,"ngIf"],["role","table",1,"cx-quick-order-table-wrapper"],[1,"cx-visually-hidden"],["role","row",1,"cx-item-list-header","cx-quick-order-table-header"],["role","columnheader",1,"cx-item-list-desc"],["role","columnheader",1,"cx-item-list-price"],["role","columnheader",1,"cx-item-list-qty"],["role","columnheader",1,"cx-item-list-actions"],[1,"cx-item-list-items"],["cx-quick-order-item","","class","cx-item-list-row cx-quick-order-table-row",3,"entry","index","loading",4,"ngFor","ngForOf"],["cx-quick-order-item","",1,"cx-item-list-row","cx-quick-order-table-row",3,"entry","index","loading"]],template:function(i,r){i&1&&m(0,vi,20,16,"table",0),i&2&&s("ngIf",(r.entries==null?null:r.entries.length)>0)},dependencies:[ee,K,Hi,j],encapsulation:2,changeDetection:0})}}return t})(),zi=(()=>{class t{constructor(e,i,r,n,g){this.activeCartService=e,this.component=i,this.globalMessageService=r,this.quickOrderService=n,this.quickOrderStatePersistenceService=g,this.quickOrderListLimit$=this.component.data$.pipe(P(y=>y.quickOrderListLimit),W(y=>{y&&this.quickOrderService.setListLimit(y)})),this.isCartStable$=Ae([this.activeCartService.getActiveCartId(),this.activeCartService.isStable()]).pipe(P(([y,Rt])=>y?Rt:!0)),this.globalMessageType=$,this.cartErrors$=new w([]),this.cartWarnings$=new w([]),this.cartSuccesses$=new w([]),this.showAddToCartInformation$=new w(!1),this.nonPurchasableProductError$=new w(null)}ngOnInit(){this.cartId$=this.activeCartService.getActiveCartId(),this.entries$=this.quickOrderService.getEntries(),this.quickOrderStatePersistenceService.initSync()}ngOnDestroy(){this.quickOrderService.clearDeletedEntries()}get errors$(){return this.cartErrors$.asObservable()}get warnings$(){return this.cartWarnings$.asObservable()}get successes$(){return this.cartSuccesses$.asObservable()}get nonPurchasableError$(){return this.quickOrderService.getNonPurchasableProductError()}get addToCartInformation$(){return this.showAddToCartInformation$.asObservable()}get softDeletedEntries$(){return this.quickOrderService.getSoftDeletedEntries()}clear(){this.quickOrderService.clearList(),this.globalMessageService.add({key:"quickOrderTable.listCleared"},$.MSG_TYPE_INFO)}addToCart(e){if(!e.length){this.showAddToCartInformation$.next(!0);return}this.clearStatuses(),this.quickOrderService.addToCart().pipe(L()).subscribe(([i,r])=>{r.forEach(n=>{n.entry||(n.entry=e.find(g=>g.product?.code===n.productCode))}),this.extractErrors(r),this.extractWarnings(r),r.length?this.extractSuccesses(r,i):this.showAddedToCartSuccessMessage()})}clearErrors(){this.cartErrors$.next([])}clearWarnings(){this.cartWarnings$.next([])}clearSuccesses(){this.cartSuccesses$.next([])}clearAddToCartInformation(){this.showAddToCartInformation$.next(!1)}undoDeletion(e){e.product?.code&&this.quickOrderService.restoreSoftDeletedEntry(e.product.code)}clearDeletion(e){e.product?.code&&this.quickOrderService.hardDeleteEntry(e.product.code)}clearNonPurchasableError(){this.quickOrderService.clearNonPurchasableProductError()}canAddProduct(){return this.quickOrderService.canAdd()}extractErrors(e){let i=e.filter(r=>r.quantityAdded===0);this.setErrors(i)}extractWarnings(e){let i=e.filter(r=>r.quantityAdded!==0);this.setWarnings(i)}extractSuccesses(e,i){let r=[];i.forEach(n=>{e.find(y=>y.productCode===n.product?.code)||r.push(n)}),this.setSuccesses(r)}clearStatuses(){this.clearErrors(),this.clearWarnings(),this.clearSuccesses()}showAddedToCartSuccessMessage(){this.globalMessageService.add({key:"quickOrderTable.addedtoCart"},$.MSG_TYPE_CONFIRMATION)}setErrors(e){this.cartErrors$.next(e)}setWarnings(e){this.cartWarnings$.next(e)}setSuccesses(e){this.cartSuccesses$.next(e)}static{this.\u0275fac=function(i){return new(i||t)(b(z),b(ft),b(ye),b(Q),b(Me))}}static{this.\u0275cmp=N({type:t,selectors:[["cx-quick-order"]],viewQuery:function(i,r){if(i&1&&ue(Oi,5),i&2){let n;pe(n=me())&&(r.quickOrderForm=n.first)}},decls:17,vars:24,consts:[["quickOrderForm",""],["aria-atomic","true","aria-live","assertive","aria-relevant","additions",1,"quick-order-message-container"],[4,"ngIf"],[1,"quick-order-list-limit-message",3,"text","isVisibleCloseButton","type"],[1,"quick-order-add-to-cart-information-message",3,"closeMessage","text","type"],[1,"quick-order-non-purchasable-product-error-message",3,"closeMessage","text","type"],["class","quick-order-deletions-message",3,"actionButtonText","actionButtonMessage","text","type","buttonAction","closeMessage",4,"ngFor","ngForOf"],[1,"quick-order-deletions-message",3,"buttonAction","closeMessage","actionButtonText","actionButtonMessage","text","type"],["class","quick-order-errors-message",3,"accordionText","text","type","closeMessage",4,"ngIf"],[1,"quick-order-errors-message",3,"closeMessage","accordionText","text","type"],[1,"quick-order-errors"],["class","quick-order-error-item",4,"ngFor","ngForOf"],[1,"cx-visually-hidden"],[1,"quick-order-error-item"],["class","quick-order-warnings-message",3,"accordionText","text","type","closeMessage",4,"ngIf"],[1,"quick-order-warnings-message",3,"closeMessage","accordionText","text","type"],[1,"quick-order-warnings"],["class","quick-order-warning-item",4,"ngFor","ngForOf"],[1,"quick-order-warning-item"],["class","quick-order-successes-message",3,"text","type","closeMessage",4,"ngIf"],[1,"quick-order-successes-message",3,"closeMessage","text","type"],[1,"quick-order-successes"],["class","quick-order-success-item",4,"ngFor","ngForOf"],[1,"quick-order-success-item"],[1,"quick-order-header"],[1,"quick-order-form-body"],[3,"limit"],[1,"quick-order-table-body"],[3,"entries","loading"],[1,"quick-order-footer","row"],[1,"col-xs-12","col-md-5","col-lg-3"],["class","btn btn-block btn-secondary clear-button","type","button",3,"disabled","click",4,"ngIf"],[3,"clickEvent","ariaLabel","loading"],["type","button",1,"btn","btn-block","btn-secondary","clear-button",3,"click","disabled"]],template:function(i,r){i&1&&(l(0,"div",1),m(1,Ti,3,3,"ng-container",2),c(2,"async"),m(3,Ei,3,4,"ng-container",2),c(4,"async"),m(5,Fi,3,7,"ng-container",2),c(6,"async"),m(7,Ii,3,3,"ng-container",2),c(8,"async"),m(9,Pi,2,1,"ng-container",2),c(10,"async"),m(11,$i,2,1,"ng-container",2),c(12,"async"),m(13,Vi,2,1,"ng-container",2),c(14,"async"),p(),m(15,ji,3,3,"ng-container",2),c(16,"async")),i&2&&(o(),s("ngIf",a(2,8,r.entries$)),o(2),s("ngIf",a(4,10,r.addToCartInformation$)),o(2),s("ngIf",a(6,12,r.nonPurchasableError$)),o(2),s("ngIf",a(8,14,r.softDeletedEntries$)),o(2),s("ngIf",a(10,16,r.errors$)),o(2),s("ngIf",a(12,18,r.warnings$)),o(2),s("ngIf",a(14,20,r.successes$)),o(2),s("ngIf",a(16,22,r.quickOrderListLimit$)))},dependencies:[ee,K,bt,vt,Ui,Ki,te,Ke,j],encapsulation:2,changeDetection:0})}}return t})(),Xi=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=A({type:t})}static{this.\u0275inj=B({providers:[xe({cmsComponents:{QuickOrderComponent:{component:zi,data:{quickOrderListLimit:10}}}})],imports:[ht,fe,Qe,ve,gt,kt,xt,qt,Ot,we,he,ct,ke]})}}return t})(),$t=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=A({type:t})}static{this.\u0275inj=B({providers:[{provide:Et,useExisting:Yi}],imports:[he,Xi,Wi]})}}return t})();var Sr=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=A({type:t})}static{this.\u0275inj=B({imports:[It,$t]})}}return t})();export{Sr as QuickOrderModule};
